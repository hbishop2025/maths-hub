<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths | Bishop & Co. Shakes</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <style type="text/tailwindcss">
    :root { --accent1:#7C3AED; --accent2:#3B82F6; }

    body { @apply bg-[#f6f6f8] text-[#212121] font-[Lexend]; overflow-x:hidden; }

    /* Dotted paper background */
    .math-grid {
      background-image:
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0),
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      mask-image: linear-gradient(to bottom, white 65%, transparent 100%);
    }

    .header { @apply fixed top-0 left-0 right-0 z-30 bg-white/85 backdrop-blur border-b border-gray-200; }
    
    #mobileMenu {
      @apply absolute right-4 top-[3.25rem] bg-white/90 backdrop-blur-md border border-gray-200 shadow-lg rounded-xl px-4 py-3 z-40;
      width: 180px;
      transform-origin: top right;
      animation: menuIn .22s ease-out;
    }
    #mobileMenu a { @apply block text-sm font-medium text-gray-700 hover:text-[#135bec] py-1 text-center; }

    @keyframes menuIn {
      from { opacity: 0; transform: translateY(-6px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0)    scale(1); }
    }
  </style>

  <style>
      :root {
          /* Brand Colors */
          --brand-primary: #000;
          --brand-accent: #ff4e00; 
          --card-bg: #fff;
      }

      /* --- HERO & BRANDING SECTION --- */
      .hero {
          text-align: center;
          padding: 80px 20px 40px;
          border-bottom: 1px solid #e5e7eb;
          background: rgba(255,255,255,0.5);
      }

      .hero h1 {
          font-size: 56px;
          font-weight: 900;
          margin-bottom: 10px;
          text-transform: uppercase;
          letter-spacing: -2px;
          line-height: 1;
      }

      .hero p {
          font-size: 20px;
          color: #555;
          margin-bottom: 20px;
      }

      /* --- FILTER & GRID --- */
      .container-custom {
          max-width: 1400px;
          margin: 0 auto;
          padding: 40px 20px;
      }

      /* Category Headers */
      .category-title {
          font-size: 24px;
          font-weight: 900;
          text-transform: uppercase;
          margin: 40px 0 20px 0;
          padding-bottom: 10px;
          border-bottom: 2px solid #eee;
          color: var(--brand-primary);
      }

      .product-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 30px;
          margin-bottom: 40px;
      }

      .product-card {
          background: var(--card-bg);
          border-radius: 8px;
          overflow: hidden;
          transition: transform 0.3s ease;
          position: relative;
          box-shadow: 0 4px 10px rgba(0,0,0,0.05);
          display: flex;
          flex-direction: column;
          border: 1px solid #eee;
      }

      .product-card:hover { transform: translateY(-5px); }

      .badge {
          position: absolute;
          top: 10px; left: 10px;
          background-color: var(--brand-accent);
          color: white;
          padding: 5px 10px;
          font-size: 10px;
          font-weight: bold;
          text-transform: uppercase;
          border-radius: 2px;
          z-index: 2;
      }

      .product-image {
          width: 100%;
          height: 280px;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
      }

      /* Dynamic Backgrounds */
      .bg-vanilla { background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); }
      .bg-choc { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }
      .bg-fruit { background: linear-gradient(135deg, #fff1eb 0%, #ace0f9 100%); }
      .bg-berry { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }

      .product-info {
          padding: 20px;
          text-align: center;
          flex-grow: 1;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
      }

      .product-title { font-weight: 800; font-size: 18px; margin-bottom: 5px; }
      .product-tagline { font-size: 13px; color: #777; margin-bottom: 10px; font-style: italic; }
      .price { font-size: 18px; font-weight: 900; color: #000; display: block; margin-bottom: 10px;}

      /* Buttons in Card */
      .btn-group { display: flex; gap: 10px; }
      
      .btn {
          flex: 1;
          padding: 10px;
          border: none;
          font-weight: bold;
          text-transform: uppercase;
          cursor: pointer;
          font-size: 12px;
          transition: 0.2s;
      }

      .btn-primary { background: var(--brand-primary); color: white; }
      .btn-primary:hover { background: var(--brand-accent); }

      .btn-outline { background: transparent; border: 1px solid #ccc; color: #333; }
      .btn-outline:hover { border-color: #000; color: #000; }

      /* --- FLOATING CART (Bottom RIGHT) --- */
      .cart-float-container {
          position: fixed;
          bottom: 20px;
          right: 20px; /* Moved to Right */
          z-index: 2000;
          font-family: 'Lexend', sans-serif;
      }

      .cart-toggle-btn {
          background-color: var(--brand-accent);
          color: white;
          width: 60px;
          height: 60px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          cursor: pointer;
          border: none;
          position: relative;
      }
      
      .cart-toggle-btn .material-symbols-outlined {
          font-size: 28px;
          color: white;
      }

      .cart-count-badge {
          position: absolute;
          top: -5px;
          left: -5px; /* Moved badge to left since button is on right */
          background: black;
          color: white;
          font-size: 12px;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .cart-panel {
          position: absolute;
          bottom: 80px;
          right: 0; /* Align to right */
          width: 300px;
          background: white;
          border: 2px solid #000;
          border-radius: 8px;
          padding: 15px;
          display: none; /* Hidden by default */
          flex-direction: column;
          box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      }

      .cart-panel.open { display: flex; }

      .cart-header { font-weight: 900; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; display: flex; justify-content: space-between;}
      
      .cart-items { max-height: 200px; overflow-y: auto; font-size: 13px; }
      .cart-item-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dotted #eee; padding-bottom: 5px; }
      .remove-item { color: red; cursor: pointer; margin-left: 10px; font-weight: bold; }

      .cart-total { margin-top: 10px; padding-top: 10px; border-top: 2px solid #000; font-weight: bold; text-align: right; }

      .pay-btn {
          background: black; color: white; border: none; padding: 10px; width: 100%; margin-top: 10px;
          font-weight: bold; cursor: pointer; text-transform: uppercase;
          transition: all 0.2s ease;
      }
      .pay-btn:hover { background: var(--brand-accent); }

      /* --- GLITCH BUTTON ANIMATION --- */
      .pay-btn.glitching {
          background-color: red !important;
          animation: glitch-anim 0.2s infinite;
      }

      @keyframes glitch-anim {
          0% { transform: translate(0) }
          20% { transform: translate(-3px, 3px) }
          40% { transform: translate(-3px, -3px) }
          60% { transform: translate(3px, 3px) }
          80% { transform: translate(3px, -3px) }
          100% { transform: translate(0) }
      }

      /* --- INGREDIENTS MODAL --- */
      .modal-overlay {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.7);
          z-index: 3000;
          display: none;
          align-items: center;
          justify-content: center;
      }

      .modal-content {
          background: white;
          padding: 30px;
          border-radius: 8px;
          max-width: 500px;
          width: 90%;
          position: relative;
      }

      .modal-close {
          position: absolute; top: 10px; right: 15px;
          font-size: 24px; cursor: pointer;
      }

      .modal-title { font-size: 24px; font-weight: 900; margin-bottom: 15px; color: var(--brand-accent); }
      .ingredient-list li { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee; }

      .env-section {
          background: #e9f5e9;
          padding: 60px 20px;
          text-align: center;
          border-top: 1px solid #ccc;
          margin-top: 40px;
      }
  </style>
</head>
<body>

  <header class="header">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between relative">
      <div class="flex items-center gap-3">
        <img src="assets/hub_logo.png" alt="SJWMS" class="h-7 w-auto"/>
        <span class="font-extrabold tracking-tight">SJWMS Maths</span>
      </div>

      <nav class="hidden md:flex items-center gap-6">
        <a class="text-sm font-medium text-[#135bec]" href="index.html">Home</a>
        <a class="text-sm font-medium text-gray-700 hover:text-[#135bec] transition" href="ks3_hub.html">KS3</a>
        <a class="text-sm font-medium text-gray-700 hover:text-[#135bec] transition" href="gcse_hub.html">GCSE</a>
        <a class="text-sm font-medium text-gray-700 hover:text-[#135bec] transition"
           href="alevel_hub.html">A-Level</a>
        <a class="px-4 py-2 rounded-full bg-[#111827] text-white text-sm font-semibold" href="ai_usage.html">
          AI Usage
        </a>
      </nav>

      <button id="menuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-200/60">
        <span class="material-icons">menu</span>
      </button>

      <div id="mobileMenu" class="hidden">
        <a href="index.html">Home</a>
        <a href="ks3_hub.html">KS3</a>
        <a href="gcse_hub.html">GCSE</a>
        <a href="alevel_hub.html">A-Level</a>
        <a class="rounded-full bg-[#111827] text-white font-semibold mt-2 py-1.5 px-3 block" href="ai_usage.html">AI Usage</a>
      </div>
    </div>
  </header>

  <div class="absolute inset-0 math-grid pointer-events-none fixed"></div>

  <main class="relative pt-16">
      
      <section class="hero">
          <h1>BISHOP & CO. SHAKES</h1>
          <p>Fuel your brain. Calculate the taste.</p>
      </section>

      <div class="container-custom" id="catalog-container">
          </div>

      <section class="env-section">
          <h2 style="text-transform: uppercase; font-weight: 900; margin-bottom: 20px;">Zero Impact. Infinite Flavor.</h2>
          <p style="max-width: 700px; margin: 0 auto; color:#555;">
              Our cups are biodegradable, and our ingredients are locally sourced to ensure the lowest carbon integer possible. 
              We calculate our emissions so you don't have to.
          </p>
      </section>

  </main>

  <div id="footer-slot"></div>
  <script src="assets/footer-loader.js" defer></script>

  <div class="cart-float-container">
      <div class="cart-panel" id="cart-panel">
          <div class="cart-header">
              <span>Your Tray</span>
              <span style="cursor: pointer;" onclick="toggleCart()">✕</span>
          </div>
          <div class="cart-items" id="cart-items">
              <p style="color:#777; text-align:center; padding: 10px;">Tray is empty.</p>
          </div>
          <div class="cart-total" id="cart-total">Total: £0.00</div>
          <button id="payBtn" class="pay-btn" onclick="processPayment()">PAY NOW</button>
      </div>
      <button class="cart-toggle-btn" onclick="toggleCart()">
          <span class="material-symbols-outlined">shopping_cart</span>
          <div class="cart-count-badge" id="cart-count">0</div>
      </button>
  </div>

  <div class="modal-overlay" id="ing-modal">
      <div class="modal-content">
          <span class="modal-close" onclick="closeModal()">&times;</span>
          <h3 class="modal-title" id="modal-title">Ingredients</h3>
          <ul id="modal-list" class="ingredient-list">
              </ul>
          <p id="modal-allergy" style="margin-top: 15px; font-size: 12px; color: red; font-weight: bold;"></p>
      </div>
  </div>

  <script>
  (function(){
    const btn=document.getElementById('menuBtn');
    const menu=document.getElementById('mobileMenu');
    function closeMenu(){ menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }
    function toggleMenu(e){ e.stopPropagation(); const open=menu.classList.contains('hidden'); menu.classList.toggle('hidden',!open); btn.setAttribute('aria-expanded',String(open)); }
    btn.addEventListener('click',toggleMenu);
    document.addEventListener('click',e=>{ if(!e.target.closest('#mobileMenu')&&!e.target.closest('#menuBtn')) closeMenu(); });
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeMenu(); });
  })();
  </script>

  <script>
      // --- 1. DATA SETUP ---
      const fallbackData = {
        "products": [
          {
            "id": "classic-shake",
            "type": "milkshake",
            "name": "The Classic Shake",
            "tagline": "A classic vanilla blend that’s simply value.",
            "price": 5.50,
            "image": "classic.png",
            "badges": ["FAN FAVE", "VANILLA"],
            "ingredients": ["200g vanilla ice cream", "150ml milk", "50ml whipped cream"],
            "allergy_note": "Contains dairy."
          },
          {
            "id": "alge-brrr",
            "type": "milkshake",
            "name": "Alge-brrr Triple Chocolate",
            "tagline": "Add rich chocolate, subtract brain freeze.",
            "price": 6.25,
            "image": "choc.png",
            "badges": ["NEW", "CHOCOLATE"],
            "ingredients": ["250g chocolate ice cream", "150ml milk", "100ml chocolate syrup", "50ml whipped cream"],
            "allergy_note": "Contains dairy."
          },
          {
            "id": "pi-neapple",
            "type": "milkshake",
            "name": "The Pi-neapple Perfection",
            "tagline": "A never-ending swirl of pineapple and vanilla.",
            "price": 5.75,
            "image": "pineapple.png",
            "badges": ["LIMITLESS", "TROPICAL"],
            "ingredients": ["150ml pineapple juice", "200g vanilla ice cream", "100ml milk", "50ml whipped cream"],
            "allergy_note": "Contains dairy."
          },
          {
            "id": "fraction-frenzy",
            "type": "milkshake",
            "name": "Fraction Frenzy Strawberry",
            "tagline": "Half strawberry, half vanilla, 100% delicious.",
            "price": 5.95,
            "image": "strawberry.png",
            "badges": ["HALF & HALF", "BERRY"],
            "ingredients": ["150g strawberry ice cream", "150g vanilla ice cream", "100ml milk", "50ml strawberry syrup"],
            "allergy_note": "Contains dairy."
          },
          {
            "id": "sqrt-berry",
            "type": "smoothie",
            "name": "Square Root Berry Blast",
            "tagline": "A radical mix of berries for refreshment.",
            "price": 5.95,
            "image": "berry.png",
            "badges": ["SMOOTHIE", "FRESH"],
            "ingredients": ["200g strawberries", "150g blueberries", "100g raspberries", "150ml yogurt", "50ml honey"],
            "allergy_note": "May contain dairy (yogurt)."
          },
          {
            "id": "tangent-tropical",
            "type": "smoothie",
            "name": "Tangent Tropical Twist",
            "tagline": "A smooth curve of mango, banana & orange.",
            "price": 6.10,
            "image": "tropical.png",
            "badges": ["SMOOTHIE", "TROPICAL"],
            "ingredients": ["150g mango", "150g banana", "200ml orange juice", "100ml yogurt", "50ml honey"],
            "allergy_note": "May contain dairy (yogurt)."
          },
          {
            "id": "extra-whip",
            "type": "extras",
            "name": "Extra Whipped Cream",
            "tagline": "Because life is better with toppings.",
            "price": 0.75,
            "image": "extra-whip.jpg",
            "badges": ["EXTRA"],
            "ingredients": ["50ml whipped cream"],
            "allergy_note": "Contains dairy."
          },
          {
            "id": "syrup-shot",
            "type": "extras",
            "name": "Syrup Shot",
            "tagline": "Chocolate, strawberry or honey.",
            "price": 0.50,
            "image": "syrup.jpg",
            "badges": ["EXTRA"],
            "ingredients": ["One 20ml syrup shot (choice of flavour)"],
            "allergy_note": "Check ingredients for specific syrup allergies."
          }
        ]
      };

      let productCatalog = [];
      let cart = [];

      async function init() {
          try {
              const response = await fetch('assets/data/bishop_shakes.json');
              if (!response.ok) throw new Error("File not found");
              const data = await response.json();
              productCatalog = data.products;
          } catch (e) {
              console.log("Using fallback data");
              productCatalog = fallbackData.products;
          }
          renderCatalog();
      }

      // --- 2. RENDER GRID (Grouped) ---
      function getBgClass(name) {
          const n = name.toLowerCase();
          if(n.includes('chocolate') || n.includes('syrup')) return 'bg-choc';
          if(n.includes('berry') || n.includes('strawberry')) return 'bg-berry';
          if(n.includes('tropical') || n.includes('pineapple') || n.includes('banana')) return 'bg-fruit';
          return 'bg-vanilla';
      }

      function renderCatalog() {
          const container = document.getElementById('catalog-container');
          container.innerHTML = '';

          // Define groups
          const groups = [
            { id: 'milkshake', title: 'Milkshakes' },
            { id: 'smoothie', title: 'Smoothies' },
            { id: 'extras', title: 'Extras' }
          ];

          groups.forEach(group => {
              // Filter products for this group
              const items = productCatalog.filter(p => p.type === group.id);
              
              if(items.length > 0) {
                  // Add Header
                  const sectionTitle = document.createElement('h2');
                  sectionTitle.className = 'category-title';
                  sectionTitle.innerText = group.title;
                  container.appendChild(sectionTitle);

                  // Create Grid
                  const grid = document.createElement('div');
                  grid.className = 'product-grid';

                  // Add Items
                  items.forEach(p => {
                      const bg = getBgClass(p.name);
                      const badge = p.badges[0] ? `<div class="badge">${p.badges[0]}</div>` : '';
                      
                      const cardHTML = `
                      <div class="product-card">
                          ${badge}
                          <div class="product-image ${bg}">
                              <img src="assets/${p.image}" 
                                 style="width: 80%; height: auto; object-fit: contain;" 
                                 alt="${p.name}">
                          </div>
                          <div class="product-info">
                              <div>
                                  <h3 class="product-title">${p.name}</h3>
                                  <p class="product-tagline">${p.tagline}</p>
                                  <span class="price">£${p.price.toFixed(2)}</span>
                              </div>
                              <div class="btn-group">
                                  <button class="btn btn-outline" onclick="openIngredients('${p.id}')">Ingredients</button>
                                  <button class="btn btn-primary" onclick="addToCart('${p.id}')">Add to Tray</button>
                              </div>
                          </div>
                      </div>`;
                      grid.insertAdjacentHTML('beforeend', cardHTML);
                  });
                  
                  container.appendChild(grid);
              }
          });
      }

      // --- 3. CART LOGIC ---
      function toggleCart() {
          const panel = document.getElementById('cart-panel');
          panel.classList.toggle('open');
      }

      function addToCart(id) {
          const item = productCatalog.find(p => p.id === id);
          cart.push(item);
          updateCartUI();
          
          const panel = document.getElementById('cart-panel');
          if(!panel.classList.contains('open')) panel.classList.add('open');
      }

      function removeFromCart(index) {
          cart.splice(index, 1);
          updateCartUI();
      }

      function updateCartUI() {
          const countEl = document.getElementById('cart-count');
          const itemsEl = document.getElementById('cart-items');
          const totalEl = document.getElementById('cart-total');

          countEl.innerText = cart.length;
          
          if (cart.length === 0) {
              itemsEl.innerHTML = '<p style="color:#777; text-align:center;">Tray is empty.</p>';
              totalEl.innerText = 'Total: £0.00';
              return;
          }

          let html = '';
          let total = 0;
          
          cart.forEach((item, index) => {
              total += item.price;
              html += `
              <div class="cart-item-row">
                  <span>${item.name}</span>
                  <span>£${item.price.toFixed(2)} <span class="remove-item" onclick="removeFromCart(${index})">✕</span></span>
              </div>`;
          });

          itemsEl.innerHTML = html;
          totalEl.innerText = 'Total: £' + total.toFixed(2);
      }

      // --- 4. GLITCH PAYMENT (BUTTON ONLY) ---
      function processPayment() {
          if(cart.length === 0) return alert("Tray is empty!");

          const btn = document.getElementById('payBtn');
          const originalText = btn.innerText;

          // Apply glitch class
          btn.classList.add('glitching');
          btn.innerText = "SYSTEM ERROR";
          btn.disabled = true;

          // Stop after 3 seconds
          setTimeout(() => {
              btn.classList.remove('glitching');
              btn.innerText = originalText;
              btn.disabled = false;
              cart = []; // Clear cart
              updateCartUI();
              alert("Payment Failed... but we gave you the shakes anyway!");
          }, 3000);
      }

      // --- 5. INGREDIENTS MODAL ---
      function openIngredients(id) {
          const item = productCatalog.find(p => p.id === id);
          const modal = document.getElementById('ing-modal');
          const list = document.getElementById('modal-list');
          const title = document.getElementById('modal-title');
          const allergy = document.getElementById('modal-allergy');

          title.innerText = item.name;
          list.innerHTML = '';
          
          if(item.ingredients) {
              item.ingredients.forEach(ing => {
                  list.innerHTML += `<li>${ing}</li>`;
              });
          } else {
              list.innerHTML = '<li>Ingredients not listed.</li>';
          }

          allergy.innerText = item.allergy_note || "";
          modal.style.display = 'flex';
      }

      function closeModal() {
          document.getElementById('ing-modal').style.display = 'none';
      }

      window.onclick = function(event) {
          const modal = document.getElementById('ing-modal');
          if (event.target == modal) {
              modal.style.display = "none";
          }
      }

      init();
  </script>
</body>
</html>
