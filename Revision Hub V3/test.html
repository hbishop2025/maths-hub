<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths — Glow Search (Test)</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;800;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <style>
    :root{
      --accent1:#7C3AED; /* purple */
      --accent2:#3B82F6; /* blue   */
      --accent3:#10B981; /* green  */
    }
    body{ font-family:Lexend,system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#f6f6f8; color:#212121; overflow-x:hidden;}

    /* dotted bg + faint geometric lines */
    .math-grid{
      position:fixed; inset:0; z-index:-2; pointer-events:none;
      background-image:
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0),
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0);
      background-size:40px 40px; background-position:0 0, 20px 20px;
      -webkit-mask-image:linear-gradient(to bottom, #fff 65%, transparent 100%);
              mask-image:linear-gradient(to bottom, #fff 65%, transparent 100%);
    }
    .bg-lines{
      position:fixed; inset:0; z-index:-1; pointer-events:none; opacity:.22;
      -webkit-mask-image:linear-gradient(to bottom, #fff 55%, transparent 100%);
              mask-image:linear-gradient(to bottom, #fff 55%, transparent 100%);
    }

    /* header / nav */
    .nav-link{ font-size:.95rem; font-weight:600; color:#4b5563; text-decoration:none; }
    .nav-link:hover{ color:#135bec; }

    /* hero glass card */
    .hero-shell{ max-width:1200px; margin:0 auto; padding:0 1rem; }
    .hero-glass{
      margin-top:clamp(1.25rem,4vw,3rem);
      background:rgba(255,255,255,.6);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border:1px solid rgba(255,255,255,.6);
      border-radius:24px;
      box-shadow:
        0 10px 30px rgba(0,0,0,.08),
        0 0 0 1px rgba(0,0,0,.03),
        0 12px 48px rgba(124,58,237,.06),
        0 16px 56px rgba(59,130,246,.055);
      text-align:center;
      padding: clamp(1.25rem, 4vw, 3rem) clamp(1rem, 4vw, 2.5rem);
    }

    /* ==== SMART SEARCH (expands + siri ring) ==== */
    .smart-wrap{
      position:relative;
      width:clamp(240px, 42vw, 360px);   /* compact when idle */
      margin:1.25rem auto 0;
      transition:width .35s ease;
      border-radius:9999px;
      box-sizing:border-box;
    }
    /* expand on hover/focus (desktop) */
    @media (hover:hover){
      .smart-wrap:hover,
      .smart-wrap:focus-within{
        width:clamp(520px, 60vw, 720px);
      }
    }
    /* mobile: centered and wide but not edge-to-edge */
    @media (max-width:640px){
      .smart-wrap{ width:min(92vw, 560px); }
    }

    /* pill */
    .smart-pill{
      position:relative; z-index:2;
      display:flex; align-items:center; gap:.6rem;
      background:#fff; border:1px solid rgba(0,0,0,.06);
      border-radius:9999px; padding:.6rem .8rem;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    .smart-input{
      flex:1; border:none; outline:none; background:transparent; font-size:1rem; color:#111827;
    }
    .smart-btn{
      height:40px; padding:0 14px; border:none; border-radius:9999px; cursor:pointer;
      background:#111827; color:#fff; font-weight:700;
      transition:all .6s ease; background-size:200% auto;
    }
    .smart-btn:hover{
      background-image:linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent1));
      animation: shimmer 2s linear infinite;
      box-shadow:0 0 14px rgba(124,58,237,.35);
    }
    @keyframes shimmer{0%{background-position:0%}100%{background-position:200%}}

    /* siri-style ring — masked to only show a thin border */
    .smart-wrap::before{
      content:"";
      position:absolute; inset:-2px; border-radius:9999px; pointer-events:none; z-index:1;
      background: conic-gradient(from 0deg, var(--accent1), var(--accent2), var(--accent3), var(--accent1));
      animation: spinGlow 6s linear infinite;
      opacity:0; transition:opacity .35s ease;
      /* mask so only the ring shows (stroke look) */
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
              mask-composite: exclude;
      padding:2px; /* ring thickness */
      box-sizing:border-box;
      filter: blur(.2px); /* slight anti-aliasing */
    }
    .smart-wrap:hover::before,
    .smart-wrap:focus-within::before{ opacity:1; }
    @keyframes spinGlow{ to{ transform:rotate(360deg);} }

    /* dropdown */
    #searchSug{
      position:absolute; left:0; right:0; top:calc(100% + 8px);
      background:rgba(255,255,255,.96);
      backdrop-filter:blur(10px);
      border:1px solid rgba(0,0,0,.06);
      border-radius:14px; padding:.25rem; max-height:60vh; overflow:auto;
      opacity:0; visibility:hidden; transform:translateY(6px);
      box-shadow:0 16px 30px rgba(0,0,0,.12);
      transition:opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
      z-index:30;
    }
    #searchSug.open{ opacity:1; visibility:visible; transform:translateY(0); }

    .sug-item{
      position:relative; display:flex; align-items:center; justify-content:space-between;
      gap:.75rem; padding:.6rem .85rem; border-radius:.75rem; cursor:pointer;
    }
    .sug-item:hover, .sug-item[aria-selected="true"]{ background:#f9fafb; }
    .sug-item::before{
      content:""; position:absolute; left:10px; top:8px; bottom:8px; width:2px; border-radius:2px;
      background:transparent; transition:background .15s ease;
    }
    .sug-item:hover::before, .sug-item[aria-selected="true"]::before{
      background:linear-gradient(180deg, var(--accent1), var(--accent2));
    }
    .sug-badge{ color:#fff; font-weight:800; font-size:11px; padding:.15rem .5rem; border-radius:999px; }

    /* header layout */
    .header{ position:sticky; top:0; z-index:40; background:rgba(255,255,255,.85); backdrop-filter: blur(10px); border-bottom:1px solid #e5e7eb; }
    .container{ max-width:1200px; margin:0 auto; padding:0 1rem; }
    .nav-links{ display:none; gap:1.25rem; align-items:center; }
    @media (min-width:768px){ .nav-links{ display:flex; } }
    .mobile-menu{ display:none; position:absolute; right:1rem; top:3.25rem; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:.5rem; box-shadow:0 12px 28px rgba(0,0,0,.14); }
    .mobile-menu.open{ display:block; }
    .mobile-link{ display:block; padding:.5rem .75rem; border-radius:.5rem; color:#374151; font-weight:600; text-decoration:none; }
    .mobile-link:hover{ background:#f3f4f6; }
  </style>
</head>
<body>

  <!-- dotted + lines -->
  <div class="math-grid"></div>
  <svg class="bg-lines" viewBox="0 0 1000 700" preserveAspectRatio="none">
    <g stroke="rgba(60,70,200,0.25)" stroke-width="2" fill="rgba(60,70,200,0.06)">
      <polygon points="140,120 220,160 180,240" />
      <polygon points="360,120 440,160 480,240 400,280" />
    </g>
    <g stroke="rgba(60,70,200,0.20)" stroke-width="1" fill="none">
      <path d="M 800 140 L 860 200 L 780 250" />
      <circle cx="140" cy="600" r="40" stroke="rgba(60,70,200,0.15)" />
    </g>
  </svg>

  <!-- header -->
  <header class="header">
    <div class="container" style="height:56px; display:flex; align-items:center; justify-content:space-between;">
      <div style="display:flex; align-items:center; gap:.6rem;">
        <img src="assets/hub_logo.png" alt="SJWMS" style="height:28px; width:auto;">
        <strong>SJWMS Maths</strong>
      </div>
      <nav class="nav-links">
        <a class="nav-link" href="ks3_hub.html">KS3</a>
        <a class="nav-link" href="#">GCSE</a>
        <a class="nav-link" href="#">A-Level</a>
        <a href="explore.html" style="padding:.5rem 1rem; border-radius:9999px; background:#111827; color:#fff; font-weight:700; text-decoration:none;">Explore</a>
      </nav>
      <button id="mobileToggle" class="md:hidden" aria-label="Menu" style="padding:.4rem .55rem; border-radius:.6rem;">
        <span class="material-symbols-outlined">menu</span>
      </button>
      <div id="mobileMenu" class="mobile-menu">
        <a class="mobile-link" href="ks3_hub.html">KS3</a>
        <a class="mobile-link" href="#">GCSE</a>
        <a class="mobile-link" href="#">A-Level</a>
        <a class="mobile-link" style="background:#111827; color:#fff;" href="explore.html">Explore</a>
      </div>
    </div>
  </header>

  <!-- hero -->
  <main>
    <div class="hero-shell">
      <section class="hero-glass">
        <p class="uppercase tracking-widest text-xs text-gray-600">SJWMS Maths</p>
        <h1 class="text-4xl md:text-6xl font-black leading-tight mt-1">
          What will you <span style="background:linear-gradient(90deg,#7C3AED,#3B82F6); -webkit-background-clip:text; background-clip:text; color:transparent;">revise today</span> and master?
        </h1>
        <p class="text-lg text-gray-700 mt-3" style="max-width:42rem; margin:0 auto;">
          Use the smart search to find worksheets, videos and practice quizzes.
        </p>

        <!-- smart search -->
        <div id="smartWrap" class="smart-wrap">
          <div class="smart-pill">
            <span class="material-symbols-outlined" style="color:#9ca3af;">search</span>
            <input id="smartSearch" class="smart-input" type="text" placeholder="Search topics…" autocomplete="off"
                   aria-autocomplete="list" aria-expanded="false" aria-haspopup="listbox" role="combobox">
            <button id="smartBtn" class="smart-btn">Search</button>
          </div>
          <div id="searchSug"></div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // mobile nav
    document.getElementById('mobileToggle')?.addEventListener('click',()=>{
      document.getElementById('mobileMenu')?.classList.toggle('open');
    });

    // Smart Search (same behaviour, anchored dropdown)
    (function(){
      const input = document.getElementById('smartSearch');
      const sug   = document.getElementById('searchSug');
      const btn   = document.getElementById('smartBtn');
      if(!input || !sug) return;

      const HINTS=["Try ‘Trigonometry’","Try ‘Surds’","Try ‘Standard form’","Try ‘Indices’","Try ‘KS3 policy’"];
      let hintIdx=0;
      function cycleHint(){
        if(document.activeElement!==input && input.value.trim()===""){
          input.setAttribute('placeholder', HINTS[hintIdx % HINTS.length]); hintIdx++;
        }
      }
      cycleHint(); setInterval(cycleHint, 3000);

      const debounce=(fn,ms=250)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}};
      let INDEX=[], open=false, active=-1, current=[];
      const YEAR_COLOR_CLASS={ "Y7":"bg-orange-500","Y8":"bg-green-500","Y9":"bg-[#7B61FF]","GCSE":"bg-blue-500","A-Level":"bg-yellow-400" };
      const colorFor = l => YEAR_COLOR_CLASS[l] || "bg-gray-400";
      const normalize = s => (s||"").toLowerCase().trim();

      function scoreRow(r,q){
        const lab=normalize(r.label), lev=normalize(r.level);
        const hay=[lab, lev, ...((r.keywords||[]).map(normalize))];
        if(lab.startsWith(q)) return 100;
        if(lab.includes(q))   return 70;
        if(hay.some(h=>h.startsWith(q))) return 60;
        if(hay.some(h=>h.includes(q)))   return 40;
        return 0;
      }
      function search(q){
        const Q=normalize(q);
        if(!Q) return [];
        return INDEX.map(r=>({r,score:scoreRow(r,Q)}))
          .filter(x=>x.score>0).sort((a,b)=>b.score-a.score).slice(0,12).map(x=>x.r);
      }
      function navigate(url){ if(url) window.location.href = url; }

      function render(list){
        sug.innerHTML="";
        list.forEach((r,i)=>{
          const el=document.createElement('div');
          el.className="sug-item flex justify-between items-center";
          el.setAttribute('role','option'); el.setAttribute('data-i',i);
          el.innerHTML=`
            <div class="flex items-center gap-3 pl-2">
              <span class="sug-badge ${colorFor(r.level)}">${r.level}</span>
              <span class="text-gray-900 font-medium">${r.label}</span>
            </div>
            <span class="material-symbols-outlined text-gray-400 pr-2">arrow_forward</span>`;
          el.addEventListener('mousedown', (e)=>{ e.preventDefault(); navigate(r.url); });
          sug.appendChild(el);
        });
      }
      const setOpen = s => { open = s; sug.classList.toggle('open', open); input.setAttribute('aria-expanded', String(open)); };

      function update(){
        const q=input.value;
        current=search(q);
        active=-1;
        if(current.length===0){ setOpen(false); return; }
        render(current); setOpen(true);
      }

      const debouncedUpdate = debounce(()=>{ if(INDEX.length) update(); }, 240);
      input.addEventListener('input', debouncedUpdate);
      input.addEventListener('keydown', (e)=>{
        if(!open && (e.key==='ArrowDown' || e.key==='Tab')){ update(); return; }
        if(!open) return;
        if(e.key==='ArrowDown'){ e.preventDefault(); active=Math.min(active+1,current.length-1); }
        else if(e.key==='ArrowUp'){ e.preventDefault(); active=Math.max(active-1,0); }
        else if(e.key==='Enter'){ e.preventDefault(); if(active>=0) navigate(current[active].url); else if(current.length) navigate(current[0].url); }
        else if(e.key==='Escape'){ setOpen(false); }
      });
      btn?.addEventListener('click', ()=>{ if(current.length) navigate(current[0].url); else{ input.focus(); update(); }});
      input.addEventListener('focus', ()=>{ if(input.value.trim() && INDEX.length) update(); });
      input.addEventListener('blur', ()=>{ setTimeout(()=> setOpen(false), 120); });
      document.addEventListener('click', (e)=>{ if(!e.target.closest('#searchSug') && !e.target.closest('#smartWrap')) setOpen(false); });

      fetch('/assets/data/search_index.json', { cache:'no-store' })
        .then(r=>r.json()).then(d=>{ INDEX = Array.isArray(d) ? d : (Array.isArray(d.items) ? d.items : []); })
        .catch(()=>{ INDEX=[]; });
    })();
  </script>
</body>
</html>
