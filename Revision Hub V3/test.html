<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root { --hero-max: 1100px; }
    body{ font-family: 'Inter', sans-serif; background:#fff; color:#111827; }

    /* Top nav pill */
    .nav-pill{
      background:#fff; border:1px solid rgba(0,0,0,.06);
      border-radius:9999px; box-shadow:0 8px 24px rgba(0,0,0,.06);
      padding:.5rem; display:flex; gap:.5rem; align-items:center; justify-content:center;
      width:fit-content; margin:1.25rem auto .75rem;
    }
    .nav-pill a{
      padding:.5rem 1.1rem; border-radius:9999px; font-weight:600; color:#374151;
      transition:all .25s ease;
    }
    .nav-pill a.active{ background:#111827; color:#fff; }
    .nav-pill a:hover{ background:#f3f4f6; }

    /* Rounded hero card */
    .hero{
      width:min(var(--hero-max), 92vw);
      margin:0 auto 3rem;
      background:#f3f4f6; /* subtle grey */
      border:1px solid rgba(0,0,0,.06);
      border-radius:2rem;
      box-shadow:0 20px 40px rgba(0,0,0,.06);
      padding: clamp(1.25rem, 4vw, 3rem);
      position:relative;
    }

    /* Animated pill search */
    .smart-wrap{
      margin: 1rem auto 0;
      width: 320px;                 /* compact default */
      max-width: 100%;
      transition: width .35s ease, box-shadow .25s ease, transform .25s ease;
      position: relative;
    }
    .smart{
      display:flex; align-items:center; gap:.75rem;
      background:#fff; border:1px solid rgba(0,0,0,.06);
      border-radius:9999px; padding:.75rem 1rem;
      box-shadow:0 8px 18px rgba(0,0,0,.05);
    }
    .smart input{
      flex:1; border:none; outline:none; background:transparent; font-size:1rem;
    }
    .smart button{
      background:#111827; color:#fff; border:none; border-radius:9999px;
      padding:.5rem 1rem; font-weight:600; cursor:pointer; transition: all .45s ease;
      background-size:200% auto;
    }
    .smart button:hover{
      background-image: linear-gradient(90deg,#7C3AED,#3B82F6,#7C3AED);
      animation: shimmer 2s linear infinite;
      box-shadow: 0 0 14px rgba(124,58,237,.35);
    }
    @keyframes shimmer { 0%{background-position:0%} 100%{background-position:200%} }

    /* Grow on hover/focus */
    .smart-wrap:hover,
    .smart-wrap:focus-within{ width: min(640px, 92%); transform: translateY(-1px); }

    /* Suggestions dropdown */
    #searchSug{
      position:absolute; left:0; right:0; top: calc(100% + 6px);
      background: rgba(255,255,255,.9); backdrop-filter: blur(10px);
      border:1px solid rgba(0,0,0,.06); border-radius: 1rem;
      box-shadow: 0 16px 30px rgba(0,0,0,.12);
      padding:.25rem; max-height: 60vh; overflow:auto;
      opacity:0; visibility:hidden; transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
      z-index: 20;
    }
    #searchSug.open{ opacity:1; visibility:visible; transform: translateY(0); transition: opacity .18s, transform .18s; }

    .sug-item{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.6rem .85rem; cursor:pointer; border-radius:.75rem; }
    .sug-item:hover, .sug-item[aria-selected="true"]{ background:#f9fafb; }
    .sug-badge{ font-weight:700; font-size:.75rem; padding:.15rem .5rem; border-radius:999px; color:#fff; }
    .sug-title{ font-weight:600; color:#111827; }

    /* Mobile: search always full width */
    @media (max-width: 640px){
      .smart-wrap{ width: 100%; }
      .smart-wrap:hover, .smart-wrap:focus-within{ width:100%; }
      .nav-pill{ margin-top: .75rem; }
    }
  </style>
</head>
<body>

  <!-- Top nav pill -->
  <nav class="nav-pill">
    <img src="assets/hub_logo.png" alt="SJWMS" class="h-7 w-auto mr-1.5">
    <a href="explore.html" class="active">Explore</a>
    <a href="ks3_hub.html">KS3</a>
    <a href="#">GCSE</a>
    <a href="#">A-Level</a>
  </nav>

  <!-- Rounded main body -->
  <section class="hero text-center">
    <p class="text-gray-500 text-sm tracking-widest uppercase mb-3">SJWMS Maths</p>
    <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">
      What will you <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-500">revise today</span> and master?
    </h1>
    <p class="text-gray-600 text-lg mt-3">Use the smart search to find worksheets, videos and practice quizzes.</p>

    <!-- Expanding smart search -->
    <div class="smart-wrap" id="smartWrap">
      <div class="smart">
        <input id="smartSearch" type="text" placeholder="Type to smart searchâ€¦" autocomplete="off"
               aria-autocomplete="list" aria-expanded="false" aria-haspopup="listbox" role="combobox">
        <button id="searchBtn">Search</button>
      </div>

      <!-- Suggestions -->
      <div id="searchSug" role="listbox" aria-label="Suggestions"></div>
    </div>
  </section>

  <!-- Smart search JS (uses /assets/data/search_index.json) -->
  <script>
  (function(){
    const input = document.getElementById('smartSearch');
    const sug   = document.getElementById('searchSug');
    if(!input || !sug) return;

    let INDEX = [];
    let open = false;
    let active = -1;
    let current = [];

    const YEAR_COLOR_CLASS = {
      "Y7":"bg-orange-500","Y8":"bg-green-500","Y9":"bg-[#7B61FF]","GCSE":"bg-blue-500","A-Level":"bg-yellow-400"
    };
    const colorFor = l => YEAR_COLOR_CLASS[l] || "bg-gray-400";

    const norm = s => (s||"").toLowerCase().trim();
    function score(r,q){
      const lab=norm(r.label), lev=norm(r.level);
      const hay=[lab,lev,...(r.keywords||[]).map(norm)];
      if(lab.startsWith(q)) return 100;
      if(lab.includes(q))   return 70;
      if(hay.some(h=>h.startsWith(q))) return 60;
      if(hay.some(h=>h.includes(q)))   return 40;
      return 0;
    }
    function query(q){
      const Q=norm(q); if(!Q) return [];
      return INDEX.map(r=>({r, s:score(r,Q)})).filter(x=>x.s>0).sort((a,b)=>b.s-a.s).slice(0,10).map(x=>x.r);
    }
    function goto(url){ if(url) location.href=url; }

    function render(list){
      sug.innerHTML="";
      list.forEach((r,i)=>{
        const el=document.createElement('div');
        el.className="sug-item";
        el.setAttribute('role','option');
        el.setAttribute('data-i',i);
        el.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="sug-badge ${colorFor(r.level)}">${r.level}</span>
            <span class="sug-title">${r.label}</span>
          </div>
          <span class="text-gray-400 material-icons">arrow_forward</span>
        `;
        el.addEventListener('mousedown', e=>{ e.preventDefault(); goto(r.url); });
        sug.appendChild(el);
      });
    }
    function setOpen(v){
      open=v; sug.classList.toggle('open', v);
      input.setAttribute('aria-expanded', String(v));
    }
    function update(){
      const q=input.value; current=query(q); active=-1;
      if(!current.length){ setOpen(false); return; }
      render(current); setOpen(true);
    }
    function highlight(i){
      Array.from(sug.children).forEach((el,idx)=>{
        el.toggleAttribute('aria-selected', idx===i);
        el.classList.toggle('bg-gray-50', idx===i);
      });
    }

    input.addEventListener('input', ()=> INDEX.length && update());
    input.addEventListener('keydown', (e)=>{
      if(!open && (e.key==='ArrowDown' || e.key==='Tab')){ update(); return; }
      if(!open) return;
      if(e.key==='ArrowDown'){ e.preventDefault(); active=Math.min(active+1,current.length-1); highlight(active); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); active=Math.max(active-1,0); highlight(active); }
      else if(e.key==='Enter'){ e.preventDefault(); if(active>=0) goto(current[active].url); else if(current.length) goto(current[0].url); }
      else if(e.key==='Escape'){ setOpen(false); }
    });
    input.addEventListener('focus', ()=>{ if(input.value.trim() && INDEX.length) update(); });
    input.addEventListener('blur', ()=> setTimeout(()=> setOpen(false), 120));
    document.addEventListener('click', e=>{ if(!e.target.closest('#searchSug') && !e.target.closest('#smartWrap')) setOpen(false); });

    // Load index
    fetch('/assets/data/search_index.json',{cache:'no-store'})
      .then(r=>r.json())
      .then(d=>{ INDEX = Array.isArray(d) ? d : (Array.isArray(d.items)? d.items : []); })
      .catch(()=> INDEX = []);
  })();
  </script>
</body>
</html>
