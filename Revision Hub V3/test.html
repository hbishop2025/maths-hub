<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths (Test)</title>

  <!-- Tailwind + Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <style>
    :root { --accent1:#7C3AED; --accent2:#3B82F6; }

    body{ font-family:'Inter',sans-serif; background:#fff; color:#111827; overflow-x:hidden; }

    /* === Top nav pill === */
    .nav-pill{
      background:#fff;
      border:1px solid rgba(0,0,0,.06);
      border-radius:9999px;
      box-shadow:0 8px 24px rgba(0,0,0,.06);
      padding:.5rem;
      display:flex; gap:.5rem;
      align-items:center; justify-content:center;
      width:fit-content;
      margin:1.25rem auto 0.75rem;
    }
    .nav-pill a{
      padding:.5rem 1.1rem; border-radius:9999px;
      font-weight:600; color:#374151;
      transition:all .25s ease;
    }
    .nav-pill a.active{ background:#111827; color:#fff; }
    .nav-pill a:hover{ background:#f3f4f6; }

    /* === Full-width hero === */
    .hero{
      position:relative;
      width:100%;
      min-height:80vh;
      background:#f3f4f6;
      border-top-left-radius:2rem;
      border-top-right-radius:2rem;
      padding:clamp(2rem,5vw,4rem) 1.5rem 6rem;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center;
      box-shadow:0 -6px 24px rgba(0,0,0,.05) inset;
    }

    /* === Expanding Search === */
    .smart-wrap{
      margin-top:2rem;
      position:relative;
      width:clamp(280px,50vw,520px);
      transition:width .35s ease;
    }
    .smart-wrap:hover,
    .smart-wrap:focus-within{
      width:min(860px,92vw);
    }
    @media (max-width:640px){
      .smart-wrap{ width:min(92vw,520px); }
    }

    .smart-pill{
      position:relative;
      display:flex; align-items:center; gap:.75rem;
      background:#fff;
      border:1px solid rgba(0,0,0,.06);
      border-radius:9999px;
      padding:.75rem 1rem;
      box-shadow:0 6px 18px rgba(0,0,0,.05);
      transition: box-shadow .25s ease, transform .25s ease;
    }
    .smart-wrap:hover .smart-pill,
    .smart-wrap:focus-within .smart-pill{
      transform:translateY(-2px);
      box-shadow:
        0 0 0 2px rgba(124,58,237,.08),
        0 0 0 6px rgba(59,130,246,.06),
        0 16px 32px rgba(0,0,0,.10);
    }

    .smart-input{
      border:none; outline:none; flex:1; font-size:1rem; background:transparent;
    }
    .smart-btn{
      background:#111827; color:#fff; font-weight:600;
      border-radius:9999px; padding:.5rem 1rem;
      transition: all .6s ease; background-size:200% auto;
    }
    .smart-btn:hover{
      background-image:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent1));
      animation: shimmer 2s linear infinite;
      box-shadow:0 0 14px rgba(124,58,237,.4);
    }
    @keyframes shimmer{0%{background-position:0% center}100%{background-position:200% center}}

    /* === Dropdown (centered) === */
    #searchSug{
      position:absolute;
      left:50%; top:calc(100% + 8px);
      transform:translateX(-50%) translateY(6px);
      width:min(860px,calc(100vw - 2rem));
      background:rgba(255,255,255,.9);
      backdrop-filter:blur(10px);
      border:1px solid rgba(0,0,0,.06);
      border-radius:1rem;
      box-shadow:0 16px 30px rgba(0,0,0,.12);
      padding:.25rem;
      max-height:60vh; overflow:auto;
      opacity:0; visibility:hidden;
      transition:opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
      z-index:40;
    }
    #searchSug.open{
      opacity:1; visibility:visible; transform:translateX(-50%) translateY(0);
    }

    /* === Dropdown items + hover line === */
    .sug-item{
      position:relative;
      display:flex; align-items:center; justify-content:space-between;
      gap:.75rem; padding:.6rem .85rem;
      cursor:pointer; border-radius:.75rem;
    }
    .sug-item::before{
      content:""; position:absolute; left:10px; top:8px; bottom:8px; width:2px;
      border-radius:2px; background:transparent;
      transition:background .15s ease;
    }
    .sug-item:hover,
    .sug-item[aria-selected="true"]{ background:#f9fafb; }
    .sug-item:hover::before,
    .sug-item[aria-selected="true"]::before{
      background:linear-gradient(180deg,var(--accent1),var(--accent2));
    }
    .sug-badge{
      font-weight:700; font-size:.75rem; padding:.15rem .5rem; border-radius:999px; color:#fff;
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="nav-pill">
    <img src="assets/hub_logo.png" alt="SJWMS" class="h-7 w-auto mr-1.5">
    <a href="explore.html" class="active">Explore</a>
    <a href="ks3_hub.html">KS3</a>
    <a href="#">GCSE</a>
    <a href="#">A-Level</a>
  </nav>

  <!-- Hero (full width) -->
  <section class="hero">
    <p class="text-gray-500 text-sm tracking-widest uppercase mb-3">SJWMS Maths</p>
    <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">
      What will you <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-500">revise today</span> and master?
    </h1>
    <p class="text-gray-600 text-lg mt-3 max-w-2xl">Use the smart search to find worksheets, videos and practice quizzes.</p>

    <!-- Animated Smart Search -->
    <div id="smartWrap" class="smart-wrap mx-auto mt-8">
      <div id="smartPill" class="smart-pill">
        <input id="smartSearch" type="text" placeholder="Search topics…" autocomplete="off"
               aria-autocomplete="list" aria-expanded="false" aria-haspopup="listbox"
               role="combobox" class="smart-input">
        <button id="smartBtn" class="smart-btn">Search</button>

        <!-- Suggestions dropdown -->
        <div id="searchSug" class="absolute"></div>
      </div>
    </div>
  </section>

  <!-- Smart Search Script -->
  <script>
  (function(){
    const input=document.getElementById('smartSearch');
    const sug=document.getElementById('searchSug');
    const btn=document.getElementById('smartBtn');
    if(!input||!sug)return;

    /* rotating placeholder hints */
    const HINTS=["Try ‘Trigonometry’","Try ‘Surds’","Try ‘Standard form’","Try ‘Indices’","Try ‘KS3 policy’"];
    let hintIdx=0;
    function cycleHint(){
      if(document.activeElement!==input&&input.value.trim()===""){
        input.setAttribute('placeholder',HINTS[hintIdx%HINTS.length]); hintIdx++;
      }
    }
    cycleHint(); setInterval(cycleHint,3000);

    const debounce=(fn,ms=250)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}};
    let INDEX=[],open=false,active=-1,current=[];
    const YEAR_COLOR_CLASS={"Y7":"bg-orange-500","Y8":"bg-green-500","Y9":"bg-[#7B61FF]","GCSE":"bg-blue-500","A-Level":"bg-yellow-400"};
    const colorFor=l=>YEAR_COLOR_CLASS[l]||"bg-gray-400";
    const normalize=s=>(s||"").toLowerCase().trim();

    function scoreRow(r,q){
      const lab=normalize(r.label),lev=normalize(r.level);
      const hay=[lab,lev,...((r.keywords||[]).map(normalize))];
      if(lab.startsWith(q))return 100;
      if(lab.includes(q))return 70;
      if(hay.some(h=>h.startsWith(q)))return 60;
      if(hay.some(h=>h.includes(q)))return 40;
      return 0;
    }
    function search(q){
      const Q=normalize(q);
      if(!Q)return[];
      return INDEX.map(r=>({r,score:scoreRow(r,Q)}))
        .filter(x=>x.score>0)
        .sort((a,b)=>b.score-a.score)
        .slice(0,12)
        .map(x=>x.r);
    }
    function navigate(url){ if(url) window.location.href=url; }

    function render(list){
      sug.innerHTML="";
      list.forEach((r,i)=>{
        const el=document.createElement('div');
        el.className="sug-item flex justify-between items-center px-4 py-2 hover:bg-white/60 rounded-lg cursor-pointer transition";
        el.setAttribute('role','option'); el.setAttribute('data-i',i);
        el.innerHTML=`
          <div class="flex items-center gap-3">
            <span class="sug-badge ${colorFor(r.level)} text-white text-xs px-2 py-0.5 rounded-full font-semibold">${r.level}</span>
            <span class="text-gray-900 font-medium">${r.label}</span>
          </div>
          <span class="material-icons text-gray-400">arrow_forward</span>`;
        el.addEventListener('mousedown',e=>{e.preventDefault();navigate(r.url)});
        sug.appendChild(el);
      });
    }
    const setOpen=s=>{open=s;sug.classList.toggle('open',open);input.setAttribute('aria-expanded',String(open));};

    function update(){
      const q=input.value;
      current=search(q);
      active=-1;
      if(current.length===0){setOpen(false);return;}
      render(current); setOpen(true);
    }

    function highlight(i){
      Array.from(sug.children).forEach((el,idx)=>{
        el.classList.toggle('bg-white/70',idx===i);
        el.classList.toggle('backdrop-blur-md',idx===i);
        if(idx===i)el.setAttribute('aria-selected','true'); else el.removeAttribute('aria-selected');
      });
    }
    function ensureVisible(i){
      const c=sug.children[i]; if(!c)return;
      const chT=c.offsetTop,chB=chT+c.offsetHeight,vT=sug.scrollTop,vB=vT+sug.clientHeight;
      if(chT<vT)sug.scrollTop=chT-8; else if(chB>vB)sug.scrollTop=chB-sug.clientHeight+8;
    }

    const debouncedUpdate=debounce(()=>{if(INDEX.length)update();},260);
    input.addEventListener('input',debouncedUpdate);
    input.addEventListener('keydown',e=>{
      if(!open&&(e.key==='ArrowDown'||e.key==='Tab')){update();return;}
      if(!open)return;
      if(e.key==='ArrowDown'){e.preventDefault();active=Math.min(active+1,current.length-1);highlight(active);ensureVisible(active);}
      else if(e.key==='ArrowUp'){e.preventDefault();active=Math.max(active-1,0);highlight(active);ensureVisible(active);}
      else if(e.key==='Enter'){e.preventDefault();if(active>=0)navigate(current[active].url);else if(current.length)navigate(current[0].url);}
      else if(e.key==='Escape'){setOpen(false);}
    });
    btn?.addEventListener('click',()=>{if(current.length)navigate(current[0].url);else{input.focus();update();}});
    input.addEventListener('focus',()=>{if(input.value.trim()&&INDEX.length)update();});
    input.addEventListener('blur',()=>{setTimeout(()=>setOpen(false),120);});
    document.addEventListener('click',e=>{if(!e.target.closest('#searchSug')&&!e.target.closest('#smartWrap'))setOpen(false);});

    fetch('/assets/data/search_index.json',{cache:'no-store'})
      .then(r=>r.json()).then(d=>{INDEX=Array.isArray(d)?d:(Array.isArray(d.items)?d.items:[]);})
      .catch(()=>{INDEX=[];});
  })();
  </script>

</body>
</html>
