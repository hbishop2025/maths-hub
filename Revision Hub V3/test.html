<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root { --hero-max: 1100px; }
    body{ font-family: 'Inter', sans-serif; background:#fff; color:#111827; }

    /* Top nav pill */
    .nav-pill{
      background:#fff; border:1px solid rgba(0,0,0,.06);
      border-radius:9999px; box-shadow:0 8px 24px rgba(0,0,0,.06);
      padding:.5rem; display:flex; gap:.5rem; align-items:center; justify-content:center;
      width:fit-content; margin:1.25rem auto .75rem;
    }
    .nav-pill a{
      padding:.5rem 1.1rem; border-radius:9999px; font-weight:600; color:#374151;
      transition:all .25s ease;
    }
    .nav-pill a.active{ background:#111827; color:#fff; }
    .nav-pill a:hover{ background:#f3f4f6; }

    /* Rounded hero card */
    .hero{
      width:min(var(--hero-max), 92vw);
      margin:0 auto 3rem;
      background:#f3f4f6; /* subtle grey */
      border:1px solid rgba(0,0,0,.06);
      border-radius:2rem;
      box-shadow:0 20px 40px rgba(0,0,0,.06);
      padding: clamp(1.25rem, 4vw, 3rem);
      position:relative;
    }

    /* Animated pill search */
    .smart-wrap{
      margin: 1rem auto 0;
      width: 320px;                 /* compact default */
      max-width: 100%;
      transition: width .35s ease, box-shadow .25s ease, transform .25s ease;
      position: relative;
    }
    .smart{
      display:flex; align-items:center; gap:.75rem;
      background:#fff; border:1px solid rgba(0,0,0,.06);
      border-radius:9999px; padding:.75rem 1rem;
      box-shadow:0 8px 18px rgba(0,0,0,.05);
    }
    .smart input{
      flex:1; border:none; outline:none; background:transparent; font-size:1rem;
    }
    .smart button{
      background:#111827; color:#fff; border:none; border-radius:9999px;
      padding:.5rem 1rem; font-weight:600; cursor:pointer; transition: all .45s ease;
      background-size:200% auto;
    }
    .smart button:hover{
      background-image: linear-gradient(90deg,#7C3AED,#3B82F6,#7C3AED);
      animation: shimmer 2s linear infinite;
      box-shadow: 0 0 14px rgba(124,58,237,.35);
    }
    @keyframes shimmer { 0%{background-position:0%} 100%{background-position:200%} }

    /* Grow on hover/focus */
    .smart-wrap:hover,
    .smart-wrap:focus-within{ width: min(640px, 92%); transform: translateY(-1px); }

    /* Suggestions dropdown */
    #searchSug{
      position:absolute; left:0; right:0; top: calc(100% + 6px);
      background: rgba(255,255,255,.9); backdrop-filter: blur(10px);
      border:1px solid rgba(0,0,0,.06); border-radius: 1rem;
      box-shadow: 0 16px 30px rgba(0,0,0,.12);
      padding:.25rem; max-height: 60vh; overflow:auto;
      opacity:0; visibility:hidden; transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
      z-index: 20;
    }
    #searchSug.open{ opacity:1; visibility:visible; transform: translateY(0); transition: opacity .18s, transform .18s; }

    .sug-item{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.6rem .85rem; cursor:pointer; border-radius:.75rem; }
    .sug-item:hover, .sug-item[aria-selected="true"]{ background:#f9fafb; }
    .sug-badge{ font-weight:700; font-size:.75rem; padding:.15rem .5rem; border-radius:999px; color:#fff; }
    .sug-title{ font-weight:600; color:#111827; }

    /* Mobile: search always full width */
    @media (max-width: 640px){
      .smart-wrap{ width: 100%; }
      .smart-wrap:hover, .smart-wrap:focus-within{ width:100%; }
      .nav-pill{ margin-top: .75rem; }
    }

    /* ----- Expanding search container ----- */
.smart-wrap{
  width: clamp(280px, 48vw, 520px);
  position: relative;
  transition: width .35s ease;
}

/* expand on hover/focus (desktop) */
.smart-wrap:hover,
.smart-wrap:focus-within{
  width: min(860px, 92vw);
}

/* mobile: always expanded and no “jump” */
@media (max-width:640px){
  .smart-wrap{ width: min(92vw, 520px); }
}

/* ----- Pill styles (keeps your look) ----- */
.smart-pill{
  position: relative;
  display:flex; align-items:center; gap:.75rem;
  background:#fff;
  border:1px solid rgba(0,0,0,.06);
  border-radius:9999px;
  padding:.75rem 1rem;
  box-shadow:0 6px 18px rgba(0,0,0,.05);
  transition: box-shadow .25s ease, transform .25s ease;
}

/* gradient glow when expanded */
.smart-wrap:hover .smart-pill,
.smart-wrap:focus-within .smart-pill{
  transform: translateY(-2px);
  box-shadow:
    0 0 0 2px rgba(124,58,237,.08),
    0 0 0 6px rgba(59,130,246,.06),
    0 16px 32px rgba(0,0,0,.10);
}

/* input + button */
.smart-input{
  border:none; outline:none; flex:1; font-size:1rem; background:transparent;
}
.smart-btn{
  background:#111827; color:#fff; font-weight:600;
  border-radius:9999px; padding:.5rem 1rem;
  transition: all .6s ease; background-size:200% auto;
}
.smart-btn:hover{
  background-image: linear-gradient(90deg,#7C3AED,#3B82F6,#7C3AED);
  animation: shimmer 2s linear infinite;
  box-shadow:0 0 14px rgba(124,58,237,.4);
}
@keyframes shimmer{0%{background-position:0% center}100%{background-position:200% center}}

/* keep your frosted dropdown animation */
#searchSug{
  transform: translateX(-50%) translateY(4px);
  opacity:0; visibility:hidden; transition:opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
}
#searchSug.open{
  opacity:1; visibility:visible; transform: translateX(-50%) translateY(0);
}

    
  </style>
</head>
<body>

  <!-- Top nav pill -->
  <nav class="nav-pill">
    <img src="assets/hub_logo.png" alt="SJWMS" class="h-7 w-auto mr-1.5">
    <a href="explore.html" class="active">Explore</a>
    <a href="ks3_hub.html">KS3</a>
    <a href="#">GCSE</a>
    <a href="#">A-Level</a>
  </nav>

  <!-- Rounded main body -->
  <section class="hero text-center">
    <p class="text-gray-500 text-sm tracking-widest uppercase mb-3">SJWMS Maths</p>
    <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">
      What will you <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-500">revise today</span> and master?
    </h1>
    <p class="text-gray-600 text-lg mt-3">Use the smart search to find worksheets, videos and practice quizzes.</p>

   <!-- Smart Search (animated) -->
<div id="smartWrap" class="smart-wrap mx-auto mt-6">
  <div id="smartPill" class="smart-pill">
    <input id="smartSearch"
           type="text"
           placeholder="Search topics…"
           autocomplete="off"
           aria-autocomplete="list"
           aria-expanded="false"
           aria-haspopup="listbox"
           role="combobox"
           class="smart-input" />

    <button id="smartBtn" class="smart-btn">Search</button>

    <!-- Suggestions dropdown (your existing container id) -->
    <div id="searchSug"
         class="absolute left-1/2 top-[calc(100%+6px)] -translate-x-1/2 w-full max-w-[860px]
                bg-white/80 backdrop-blur-md border border-gray-200/60 rounded-xl shadow-lg overflow-hidden">
      <!-- suggestions injected dynamically -->
    </div>
  </div>
</div>
  </section>

  <!-- Smart search JS (uses /assets/data/search_index.json) -->
 <script>
/* ===== Smart Search (debounced + rotating hints + same dropdown) ===== */
(function(){
  const input = document.getElementById('smartSearch');
  const sug   = document.getElementById('searchSug');
  const btn   = document.getElementById('smartBtn');
  if(!input || !sug) return;

  // ---- rotating placeholder hints (only when empty & not focused) ----
  const HINTS = [
    "Try ‘Trigonometry’",
    "Try ‘Surds’",
    "Try ‘Standard form’",
    "Try ‘Indices’",
    "Try ‘KS3 policy’"
  ];
  let hintIdx = 0;
  function cycleHint(){
    if(document.activeElement !== input && input.value.trim()===""){
      input.setAttribute('placeholder', HINTS[hintIdx % HINTS.length]);
      hintIdx++;
    }
  }
  cycleHint();
  const hintTimer = setInterval(cycleHint, 3000);

  // ---- tiny debounce helper ----
  const debounce = (fn, ms=250) => {
    let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn(...args), ms); };
  };

  let INDEX = [];
  let open = false;
  let active = -1;
  let current = [];

  const YEAR_COLOR_CLASS = {
    "Y7":"bg-orange-500","Y8":"bg-green-500","Y9":"bg-[#7B61FF]","GCSE":"bg-blue-500","A-Level":"bg-yellow-400"
  };
  const colorFor = lvl => YEAR_COLOR_CLASS[lvl] || "bg-gray-400";
  const normalize = s => (s||"").toLowerCase().trim();

  function scoreRow(row, q){
    const lab = normalize(row.label);
    const lev = normalize(row.level);
    const hay = [lab, lev, ...((row.keywords||[]).map(normalize))];
    if(lab.startsWith(q)) return 100;
    if(lab.includes(q))   return 70;
    if(hay.some(h=>h.startsWith(q))) return 60;
    if(hay.some(h=>h.includes(q)))   return 40;
    return 0;
  }
  function search(q){
    const Q = normalize(q);
    if(!Q) return [];
    return INDEX.map(r=>({row:r,score:scoreRow(r,Q)}))
      .filter(x=>x.score>0)
      .sort((a,b)=>b.score-a.score)
      .slice(0,12)
      .map(x=>x.row);
  }
  function navigate(url){ if(url) window.location.href = url; }

  function render(list){
    sug.innerHTML = "";
    list.forEach((r,i)=>{
      const el = document.createElement('div');
      el.className = "sug-item flex justify-between items-center px-4 py-2 hover:bg-white/60 rounded-lg cursor-pointer transition";
      el.setAttribute('role','option');
      el.setAttribute('data-i', i);
      el.innerHTML = `
        <div class="flex items-center gap-3">
          <span class="sug-badge ${colorFor(r.level)} text-white text-xs px-2 py-0.5 rounded-full font-semibold">${r.level}</span>
          <span class="text-gray-900 font-medium">${r.label}</span>
        </div>
        <span class="material-icons text-gray-400">arrow_forward</span>
      `;
      el.addEventListener('mousedown', (e)=>{ e.preventDefault(); navigate(r.url); });
      sug.appendChild(el);
    });
  }
  const setOpen = (state)=>{
    open = state;
    sug.classList.toggle('open', open);
    input.setAttribute('aria-expanded', String(open));
  };

  function update(){
    const q = input.value;
    current = search(q);
    active = -1;
    if(current.length===0){ setOpen(false); return; }
    render(current);
    setOpen(true);
  }

  function highlight(i){
    Array.from(sug.children).forEach((el,idx)=>{
      el.classList.toggle('bg-white/70', idx===i);
      el.classList.toggle('backdrop-blur-md', idx===i);
      if(idx===i) el.setAttribute('aria-selected','true'); else el.removeAttribute('aria-selected');
    });
  }
  function ensureVisible(i){
    const child = sug.children[i];
    if(!child) return;
    const chTop = child.offsetTop, chBot = chTop + child.offsetHeight;
    const viewTop = sug.scrollTop, viewBot = viewTop + sug.clientHeight;
    if(chTop < viewTop) sug.scrollTop = chTop - 8;
    else if(chBot > viewBot) sug.scrollTop = chBot - sug.clientHeight + 8;
  }

  // debounced input handler
  const debouncedUpdate = debounce(()=>{ if(INDEX.length) update(); }, 260);

  input.addEventListener('input', debouncedUpdate);
  input.addEventListener('keydown', (e)=>{
    if(!open && (e.key==='ArrowDown' || e.key==='Tab')){ update(); return; }
    if(!open) return;
    if(e.key==='ArrowDown'){ e.preventDefault(); active = Math.min(active+1, current.length-1); highlight(active); ensureVisible(active); }
    else if(e.key==='ArrowUp'){ e.preventDefault(); active = Math.max(active-1, 0); highlight(active); ensureVisible(active); }
    else if(e.key==='Enter'){ e.preventDefault(); if(active>=0) navigate(current[active].url); else if(current.length) navigate(current[0].url); }
    else if(e.key==='Escape'){ setOpen(false); }
  });

  // button triggers top result
  btn?.addEventListener('click', ()=>{
    if(current.length){ navigate(current[0].url); }
    else{ input.focus(); update(); }
  });

  input.addEventListener('focus', ()=>{ if(input.value.trim() && INDEX.length) update(); });
  input.addEventListener('blur',  ()=>{ setTimeout(()=> setOpen(false), 120); });
  document.addEventListener('click', (e)=>{
    if(!e.target.closest('#searchSug') && !e.target.closest('#smartWrap')) setOpen(false);
  });

  // Load JSON index (unchanged path)
  fetch('/assets/data/search_index.json', { cache:'no-store' })
    .then(r=>r.json())
    .then(d=>{ INDEX = Array.isArray(d) ? d : (Array.isArray(d.items)? d.items : []); })
    .catch(()=>{ INDEX = []; });
})();
</script>
</body>
</html>
