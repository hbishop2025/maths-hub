<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJWMS Maths — Home</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <style type="text/tailwindcss">
    :root { --accent1:#7C3AED; --accent2:#3B82F6; }

    body { @apply bg-[#f6f6f8] text-[#212121] font-[Lexend]; overflow-x:hidden; }

    /* Dotted paper background */
    .math-grid {
      background-image:
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0),
        radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      mask-image: linear-gradient(to bottom, white 65%, transparent 100%);
    }

    /* Header nav link */
    .nav-link { @apply text-sm font-medium text-gray-700 hover:text-[#135bec] transition; }

    /* Hero container */
    .hero-shell { @apply relative w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8; }

    /* Glass hero */
    .hero-glass {
      margin-top: clamp(1.25rem, 5vw, 3.5rem);
      @apply relative rounded-3xl border shadow-xl text-center;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(14px);
      border-color: rgba(255,255,255,0.6);
      @apply px-6 sm:px-10 md:px-14 py-10 sm:py-14;
      box-shadow:
        0 10px 30px rgba(0,0,0,.08),
        0 0 0 1px rgba(0,0,0,.03),
        0 12px 48px rgba(124,58,237,.06),
        0 16px 56px rgba(59,130,246,.055);
    }

    /* Expanding smart search */
    .smart-wrap {
      width: clamp(240px, 42vw, 400px);
      transition: width .35s ease;
      margin: 2rem auto 0;
      position: relative;
    }
    .smart-wrap:hover,
    .smart-wrap:focus-within { width: clamp(320px, 56vw, 640px); }

    @media (max-width:640px){
      .smart-wrap { width: 90vw !important; max-width: 440px; }
      .smart-pill { padding: .6rem .9rem; }
      input.smart-input { font-size: .95rem; }
    }

    /* Pill look */
    .smart-pill {
      @apply flex items-center gap-2 bg-white border border-gray-200 rounded-full px-4 py-2.5 shadow-md;
      transition: box-shadow .25s ease, transform .25s ease;
    }
    .smart-wrap:hover .smart-pill,
    .smart-wrap:focus-within .smart-pill {
      transform: translateY(-1px);
      box-shadow:
        0 0 0 2px rgba(124,58,237,.08),
        0 0 0 6px rgba(59,130,246,.06),
        0 16px 32px rgba(0,0,0,.10);
    }

    /* Siri glow */
    .glow-wrap{ position: relative; border-radius: 9999px; isolation: isolate; }
    .glow-wrap::before{
      content:""; position:absolute; inset:-3px; border-radius:9999px;
      background: linear-gradient(90deg,#7C3AED,#3B82F6,#10B981,#F59E0B,#EC4899,#7C3AED);
      background-size: 400% 100%;
      filter: blur(6px);
      opacity: 0;
      transition: opacity .25s ease-out;
      z-index: 0;
      animation: siri-glow 8s linear infinite;
    }
    .glow-wrap:focus-within::before { opacity: 1; }
    .glow-wrap > .smart-pill{ position: relative; z-index: 1; background: #fff; }

    @keyframes siri-glow{
      0%{background-position:0% 50%}
      50%{background-position:200% 50%}
      100%{background-position:0% 50%}
    }

    .smart-input { @apply flex-1 bg-transparent border-0 focus:ring-0 text-base text-center; }

    /* Header + Mobile menu */
    .header { @apply sticky top-0 z-30 bg-white/85 backdrop-blur border-b border-gray-200; }
    #mobileMenu {
      @apply hidden absolute right-4 top-[3.25rem] bg-white/90 backdrop-blur-md border border-gray-200 shadow-lg rounded-xl px-4 py-3 z-40;
      width: 180px;
      transform-origin: top right;
      animation: menuIn .22s ease-out;
    }
    #mobileMenu a { @apply block text-sm font-medium text-gray-700 hover:text-[#135bec] py-1 text-center; }

    @keyframes menuIn {
      from { opacity: 0; transform: translateY(-6px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0)    scale(1); }
    }

    /* Suggestions dropdown */
    #searchSug{
      position:absolute; left:50%; transform:translateX(-50%) translateY(6px);
      top: calc(100% + 8px);
      width: clamp(260px, 48vw, 520px);
      background: rgba(255,255,255,.96);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      box-shadow: 0 16px 30px rgba(0,0,0,.12);
      padding:.25rem; max-height: 60vh; overflow:auto;
      opacity:0; visibility:hidden;
      transition: opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
      z-index: 40;
    }
    #searchSug.open{ opacity:1; visibility:visible; transform:translateX(-50%) translateY(0); }

    .sug-item{
      display:flex; align-items:center; justify-content:space-between;
      gap:.75rem; padding:.6rem .85rem; cursor:pointer; border-radius:.75rem;
    }
    .sug-item:hover{ background:#f9fafb; }
    .sug-badge{
      color:#fff; font-size:11px; font-weight:800; padding:.15rem .5rem; border-radius:9999px;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between relative">
      <div class="flex items-center gap-3">
        <img src="assets/hub_logo.png" alt="SJWMS" class="h-7 w-auto"/>
        <span class="font-extrabold tracking-tight">SJWMS Maths</span>
      </div>

      <nav class="hidden md:flex items-center gap-6">
        <a class="nav-link" href="ks3_hub.html">KS3</a>
        <a class="nav-link" href="#">GCSE</a>
        <a class="nav-link" href="#">A-Level</a>
        <a class="px-4 py-2 rounded-full bg-[#111827] text-white font-semibold" href="explore.html">Explore</a>
      </nav>

      <button id="menuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-200/60">
        <span class="material-symbols-outlined">menu</span>
      </button>

      <div id="mobileMenu">
        <a href="ks3_hub.html">KS3</a>
        <a href="#">GCSE</a>
        <a href="#">A-Level</a>
        <a class="rounded-full bg-[#111827] text-white font-semibold mt-2 py-1.5 px-3 block" href="explore.html">Explore</a>
      </div>
    </div>
  </header>

  <!-- Background -->
  <div class="absolute inset-0 math-grid pointer-events-none"></div>

  <!-- HERO -->
  <main class="relative">
    <div class="hero-shell">
      <section class="hero-glass">
        <p class="uppercase tracking-widest text-xs text-gray-600">SJWMS Maths</p>
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-black leading-tight mt-2">
          What will you <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-blue-500">revise today</span> and master?
        </h1>
        <p class="text-gray-700 text-lg mt-3 max-w-2xl mx-auto">
          Use the smart search to find worksheets, videos and practice quizzes.
        </p>

        <div id="smartWrap" class="smart-wrap">
          <div class="glow-wrap">
            <div class="smart-pill">
              <span class="material-symbols-outlined text-gray-400">search</span>
              <input id="smartSearch" class="smart-input" type="text" placeholder="Try ‘Trigonometry’" autocomplete="off"
                     aria-autocomplete="list" aria-expanded="false" aria-haspopup="listbox" role="combobox"/>
            </div>
            <div id="searchSug"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Mobile Menu JS -->
  <script>
  (function(){
    const btn=document.getElementById('menuBtn');
    const menu=document.getElementById('mobileMenu');
    function closeMenu(){ menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }
    function toggleMenu(e){ e.stopPropagation(); const open=menu.classList.contains('hidden'); menu.classList.toggle('hidden',!open); btn.setAttribute('aria-expanded',String(open)); }
    btn.addEventListener('click',toggleMenu);
    document.addEventListener('click',e=>{ if(!e.target.closest('#mobileMenu')&&!e.target.closest('#menuBtn')) closeMenu(); });
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeMenu(); });
  })();
  </script>

  <!-- SMART SEARCH JS -->
  <script>
  (function(){
    const input=document.getElementById('smartSearch');
    const sug=document.getElementById('searchSug');
    if(!input||!sug)return;

    const HINTS=["Try ‘Trigonometry’","Try ‘Surds’","Try ‘Standard form’","Try ‘Indices’","Try ‘KS3 policy’"];
    let hintIdx=0;
    function cycleHint(){
      if(document.activeElement!==input&&input.value.trim()===""){
        input.setAttribute('placeholder',HINTS[hintIdx%HINTS.length]); hintIdx++;
      }
    }
    cycleHint(); setInterval(cycleHint,3000);

    const debounce=(fn,ms=250)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}};
    let INDEX=[],open=false,active=-1,current=[];
    const YEAR_COLOR_CLASS={"Y7":"bg-orange-500","Y8":"bg-green-500","Y9":"bg-[#7B61FF]","GCSE":"bg-blue-500","AS-Level Pure":"bg-[#FFD1DF]","A-Level Pure":"bg-yellow-400","AS-level Stats":"bg-[#CAEEC2]","A-level Stats":"bg-[#90EE91]","AS-Level Mech":"bg-[#FFDBBB]","A-level Mech":"bg-[#FFC067]"};
    const colorFor=l=>YEAR_COLOR_CLASS[l]||"bg-blue-500";
    const normalize=s=>(s||"").toLowerCase().trim();

    function scoreRow(r,q){
      const lab=normalize(r.label),lev=normalize(r.level);
      const hay=[lab,lev,...((r.keywords||[]).map(normalize))];
      if(lab.startsWith(q))return 100;
      if(lab.includes(q))return 70;
      if(hay.some(h=>h.startsWith(q)))return 60;
      if(hay.some(h=>h.includes(q)))return 40;
      return 0;
    }

    function search(q){
      const Q=normalize(q);
      if(!Q)return[];
      return INDEX.map(r=>({r,score:scoreRow(r,Q)}))
        .filter(x=>x.score>0)
        .sort((a,b)=>b.score-a.score)
        .slice(0,12)
        .map(x=>x.r);
    }

    function navigate(url){ if(url) window.location.href=url; }

    function render(list){
      sug.innerHTML="";
      list.forEach((r,i)=>{
        const el=document.createElement('div');
        el.className="sug-item flex justify-between items-center";
        el.setAttribute('role','option');
        el.setAttribute('data-i',i);
        el.innerHTML=`
          <div class="flex items-center gap-3 pl-2">
            <span class="sug-badge ${colorFor(r.level)}">${r.level||""}</span>
            <span class="text-gray-900 font-medium">${r.label}</span>
          </div>
          <span class="material-symbols-outlined text-gray-400 pr-2">arrow_forward</span>`;
        el.addEventListener('mousedown',e=>{e.preventDefault();navigate(r.url)});
        sug.appendChild(el);
      });
    }

    const setOpen=s=>{open=s;sug.classList.toggle('open',open);input.setAttribute('aria-expanded',String(open));};

    function update(){
      const q=input.value;
      current=search(q);
      active=-1;
      if(current.length===0){setOpen(false);return;}
      render(current); setOpen(true);
    }

    function highlight(i){
      Array.from(sug.children).forEach((el,idx)=>{
        el.classList.toggle('bg-gray-50',idx===i);
        if(idx===i)el.setAttribute('aria-selected','true'); else el.removeAttribute('aria-selected');
      });
    }

    function ensureVisible(i){
      const c=sug.children[i]; if(!c)return;
      const chT=c.offsetTop,chB=chT+c.offsetHeight,vT=sug.scrollTop,vB=vT+sug.clientHeight;
      if(chT<vT)sug.scrollTop=chT-8; else if(chB>vB)sug.scrollTop=chB-sug.clientHeight+8;
    }

    const debouncedUpdate=debounce(()=>{if(INDEX.length)update();},240);
    input.addEventListener('input',debouncedUpdate);
    input.addEventListener('keydown',e=>{
      if(!open&&(e.key==='ArrowDown'||e.key==='Tab')){update();return;}
      if(!open)return;
      if(e.key==='ArrowDown'){e.preventDefault();active=Math.min(active+1,current.length-1);highlight(active);ensureVisible(active);}
      else if(e.key==='ArrowUp'){e.preventDefault();active=Math.max(active-1,0);highlight(active);ensureVisible(active);}
      else if(e.key==='Enter'){e.preventDefault();if(active>=0)navigate(current[active].url);else if(current.length)navigate(current[0].url);}
      else if(e.key==='Escape'){setOpen(false);}
    });
    input.addEventListener('focus',()=>{if(input.value.trim()&&INDEX.length)update();});
    input.addEventListener('blur',()=>{setTimeout(()=>setOpen(false),120);});
    document.addEventListener('click',e=>{if(!e.target.closest('#searchSug')&&!e.target.closest('#smartWrap'))setOpen(false);});

    fetch('/assets/data/search_index.json',{cache:'no-store'})
      .then(r=>r.json()).then(d=>{INDEX=Array.isArray(d)?d:(Array.isArray(d.items)?d.items:[]);})
      .catch(()=>{INDEX=[];});
  })();
  </script>

</body>
</html>
