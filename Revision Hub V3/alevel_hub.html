<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/svg" href="assets/favicon.svg" />
  <title>A-Level Maths Hub</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <!-- Shared CSS -->
  <link rel="stylesheet" href="assets/main.css"/>

  <style>
    :root{
      --accent:#7C4DFF;
      --accent-600:#6A3FE6;
      --accent-700:#5A35C8;
    }
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .material-icons{ font-size:24px; }
    html{ scroll-behavior:smooth; }

    /* Main track pills */
    .track-pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0.5rem 1rem;
      border-radius:9999px;
      font-size:0.875rem;
      font-weight:600;
      cursor:pointer;
      border:none;
      outline:none;
      transition:
        background-color 150ms ease,
        color 150ms ease,
        transform 150ms ease,
        box-shadow 150ms ease;
      background:#e5e7eb;     /* gray-200 */
      color:#4b5563;          /* gray-600 */
    }
    .track-pill-active{
      background:var(--accent);
      color:#ffffff;
      box-shadow:0 6px 18px rgba(0,0,0,0.18);
      transform:translateY(-1px);
    }
    .track-pill-inactive:hover{
      background:#d1d5db;     /* gray-300 */
      transform:translateY(-1px);
    }

    /* Applied filter pills (All / Stats / Mech) */
    .filter-pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0.25rem 0.75rem;
      border-radius:9999px;
      font-size:0.75rem;
      font-weight:600;
      cursor:pointer;
      border:1px solid #d1d5db;
      outline:none;
      transition:
        background-color 150ms ease,
        color 150ms ease,
        border-color 150ms ease;
      background:#f9fafb;    /* gray-50 */
      color:#4b5563;         /* gray-600 */
    }
    .filter-pill-active{
      background:#111827;    /* gray-900 */
      color:#ffffff;
      border-color:#111827;
    }
  </style>
</head>

<body class="bg-gray-100" data-page="alevel">
  <div class="layout">
    <!-- Sidebar -->
    <div id="sidebar" aria-label="Sidebar"></div>

    <!-- Main -->
    <main class="main p-8 overflow-y-auto">
      <!-- Header -->
      <header class="flex flex-wrap items-center justify-between gap-4 mb-8">
        <div class="flex items-center gap-2">
          <a href="index.html" class="inline-flex items-center text-gray-600 hover:text-gray-900">
            <span class="material-icons mr-1">arrow_back</span>
            Back to Home
          </a>
        </div>
      </header>

      <!-- Hero -->
      <section class="mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Left: title -->
          <div class="rounded-2xl p-6 bg-white border border-gray-200 lg:col-span-2">
            <div class="flex items-start gap-4">
              <span class="material-icons text-[44px] text-purple-500">functions</span>
              <div>
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900">
                  A-Level Mathematics Hub
                </h1>
                <p class="text-gray-600 mt-2">
                  Jump straight to the chapters you need across Year 12, Year 13 and Further Maths.
                  Pick a course track, choose a chapter, and start revising.
                </p>
              </div>
            </div>
          </div>

          <!-- Right: quick tip / blurb -->
          <div class="rounded-2xl p-6 bg-gray-900 text-gray-100">
            <div class="flex items-start gap-4">
              <span class="material-icons text-[40px] text-indigo-300">insights</span>
              <div>
                <h2 class="text-lg font-bold">How to use this hub</h2>
                <p class="text-sm text-gray-300 mt-2">
                  Use the pills below to switch between Year 12 Pure, Applied, Year 13, and Further.
                  Each chapter card links to a dedicated revision page.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Track selector -->
      <section aria-label="A-Level course tracks" class="mb-6">
        <div class="flex flex-col items-center">
          <div id="track-pills"
               class="flex flex-wrap justify-center gap-3">
            <!-- Pills injected by JS -->
          </div>
        </div>
      </section>

      <!-- Modules + applied filter -->
      <section aria-label="Modules for selected track">
        <div class="flex flex-col gap-2 mb-3">
          <div class="flex items-center justify-between">
            <h2 id="modules-heading" class="text-xl font-bold text-gray-800">
              Modules
            </h2>
          </div>

          <!-- Applied filter (only shown on stats/mech tracks) -->
          <div id="applied-filter"
               class="flex flex-wrap items-center gap-2 text-xs text-gray-500 hidden">
            <span class="font-semibold uppercase tracking-wide">Filter:</span>
            <button type="button"
                    class="filter-pill filter-pill-active"
                    data-filter="all">
              All
            </button>
            <button type="button"
                    class="filter-pill"
                    data-filter="statistics">
              Statistics
            </button>
            <button type="button"
                    class="filter-pill"
                    data-filter="mechanics">
              Mechanics
            </button>
          </div>
        </div>

        <div id="module-grid"
             class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
          <!-- Module cards injected by JS -->
        </div>

        <p id="modules-empty" class="text-gray-500 mt-4 hidden">
          No modules available for this track yet.
        </p>
      </section>

      <!-- Spacer -->
      <div class="h-8"></div>
    </main>
  </div>

  <!-- Sidebar loader -->
  <script src="assets/sidebar-loader.js"></script>

  <!-- Hub JS -->
  <script>
    const DATA_URL = "assets/data/alevel_structure.json";

    let tracks = [];
    let activeTrackId = null;

    // filter can be "all" | "statistics" | "mechanics"
    let appliedFilter = "all";

    function createPill(track){
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "track-pill track-pill-inactive";
      btn.dataset.trackId = track.id;
      btn.textContent = track.label;
      btn.addEventListener("click", () => {
        setActiveTrack(track.id);
      });
      return btn;
    }

    function renderPills(){
      const wrap = document.getElementById("track-pills");
      wrap.innerHTML = "";
      tracks.forEach(track => {
        wrap.appendChild(createPill(track));
      });
      updatePillClasses();
    }

    function updatePillClasses(){
      const pills = document.querySelectorAll("#track-pills .track-pill");
      pills.forEach(pill => {
        const tId = pill.dataset.trackId;
        if(tId === activeTrackId){
          pill.classList.remove("track-pill-inactive");
          pill.classList.add("track-pill-active");
        }else{
          pill.classList.remove("track-pill-active");
          pill.classList.add("track-pill-inactive");
        }
      });
    }

    function updateFilterUI(){
      const filterWrap = document.getElementById("applied-filter");
      const track = tracks.find(t => t.id === activeTrackId);
      const modules = track && Array.isArray(track.modules) ? track.modules : [];

      // Decide if this track is "applied" (has stats/mech areas)
      const hasAreas = modules.some(m => m.area === "statistics" || m.area === "mechanics");

      if(!hasAreas){
        filterWrap.classList.add("hidden");
        return;
      }

      filterWrap.classList.remove("hidden");

      // Update pill active state
      const pills = filterWrap.querySelectorAll(".filter-pill");
      pills.forEach(p => {
        if(p.dataset.filter === appliedFilter){
          p.classList.add("filter-pill-active");
        }else{
          p.classList.remove("filter-pill-active");
        }
      });
    }

    function filteredModulesFor(track){
      const modules = Array.isArray(track.modules) ? track.modules : [];

      // If no stats/mech areas, don't filter at all
      const hasAreas = modules.some(m => m.area === "statistics" || m.area === "mechanics");
      if(!hasAreas || appliedFilter === "all"){
        return modules;
      }

      return modules.filter(m => {
        if(appliedFilter === "statistics"){
          return m.area === "statistics";
        }
        if(appliedFilter === "mechanics"){
          return m.area === "mechanics";
        }
        return true;
      });
    }

    function renderModules(){
      const grid = document.getElementById("module-grid");
      const empty = document.getElementById("modules-empty");
      const heading = document.getElementById("modules-heading");

      grid.innerHTML = "";

      const track = tracks.find(t => t.id === activeTrackId);
      if(!track){
        empty.classList.remove("hidden");
        heading.textContent = "Modules";
        return;
      }

      heading.textContent = track.label + " â€” Modules";

      const modules = filteredModulesFor(track);

      if(!modules.length){
        empty.classList.remove("hidden");
      }else{
        empty.classList.add("hidden");
      }

      modules.forEach((mod, idx) => {
        const href = mod.path || "#";
        const card = document.createElement("a");
        card.href = href;
        card.className =
          "block bg-white p-4 rounded-xl shadow-sm border border-gray-200 " +
          "hover:shadow-md hover:-translate-y-0.5 transition transform " +
          "focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300";

        card.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="mt-1">
              <span class="inline-flex items-center justify-center
                           h-8 w-8 rounded-full bg-gray-900 text-white text-sm font-bold">
                ${idx + 1}
              </span>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-gray-800">${mod.title || "Untitled module"}</h3>
              ${mod.area
                ? `<p class="text-xs mt-1 px-2 py-0.5 inline-flex rounded-full border text-gray-600 bg-gray-50">
                     ${mod.area === "statistics" ? "Statistics" :
                       mod.area === "mechanics" ? "Mechanics" :
                       mod.area}
                   </p>`
                : ""}
            </div>
            <span class="material-icons text-gray-400 mt-1">arrow_forward</span>
          </div>
        `;

        grid.appendChild(card);
      });

      updateFilterUI();
    }

    function setActiveTrack(id){
      activeTrackId = id;

      // When switching track, reset filter to "all" so students don't get stuck
      appliedFilter = "all";

      updatePillClasses();
      renderModules();
    }

    async function initHub(){
      try{
        const data = await fetch(DATA_URL, { cache: "no-store" }).then(r => r.json());
        tracks = Array.isArray(data.tracks) ? data.tracks : [];
        if(!tracks.length) return;

        // Default: first track (Y12 Pure)
        activeTrackId = tracks[0].id || "y12_pure";

        // Wire up filter pills once
        const filterWrap = document.getElementById("applied-filter");
        const filterPills = filterWrap.querySelectorAll(".filter-pill");
        filterPills.forEach(pill => {
          pill.addEventListener("click", () => {
            appliedFilter = pill.dataset.filter || "all";
            renderModules();
          });
        });

        renderPills();
        renderModules();
      }catch(e){
        console.error("Failed to load A-level structure:", e);
      }
    }

    document.addEventListener("DOMContentLoaded", initHub);
  </script>
</body>
</html>
