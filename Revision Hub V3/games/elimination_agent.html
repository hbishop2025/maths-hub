<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/svg" href="/assets/favicon.svg" />
  <title>SJWMS Maths — Elimination Agent</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

  <!-- Shared layout / stripes / sidebar spacing -->
  <link rel="stylesheet" href="/assets/main.css"/>

  <style>
    :root{
      /* Agent Purple Theme */
      --accent:    #8B5CF6; /* violet-500 */
      --accent-600:#7C3AED;
      --accent-700:#6D28D9;
    }
    body { font-family: 'Inter', sans-serif; }
    .material-icons { font-size: 24px; }
    html { scroll-behavior: smooth; }

    /* Stripes background */
    body[data-page="game-template"] .bg-stripes{
      position: relative;
      background: linear-gradient(135deg, #f5f3ff, #ffffff); /* very light violet to white */
    }
    body[data-page="game-template"] .bg-stripes::after{
      content:"";
      position:absolute; inset:0; pointer-events:none;
      background: repeating-linear-gradient(
        -45deg,
        rgba(139, 92, 246, 0.05) 0px,
        rgba(139, 92, 246, 0.05) 8px,
        transparent 8px,
        transparent 16px
      );
      opacity:.7;
    }

    /* Equation Card Styles */
    .eq-card {
        font-family: 'Courier New', Courier, monospace;
        letter-spacing: -0.5px;
    }
    
    .variable-highlight {
        display: inline-block;
        padding: 0 4px;
        border-radius: 4px;
        transition: background 0.3s;
    }

    /* Animations */
    @keyframes slideIn {
        from { transform: translateY(10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .slide-in { animation: slideIn 0.3s ease-out forwards; }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-4px); }
        75% { transform: translateX(4px); }
    }
    .shake { animation: shake 0.3s ease-in-out; }

    .confetti {
      position: absolute;
      width: 10px; height: 10px;
      background: #f00;
      animation: fall linear forwards;
    }
    @keyframes fall {
      to { transform: translateY(100vh) rotate(720deg); }
    }
  </style>
</head>

<body class="bg-gray-100"
      data-page="game-template">
  <div class="layout">
    <!-- Sidebar -->
    <div id="sidebar" aria-label="Sidebar"></div>

    <!-- Main content -->
    <main class="main p-8 overflow-y-auto">
      <!-- Top: back + title -->
      <header class="flex flex-wrap items-center justify-between gap-4 mb-6">
        <div class="flex items-center gap-3">
          <a href="/index.html" class="inline-flex items-center text-gray-600 hover:text-gray-900">
            <span class="material-icons mr-1">arrow_back</span>
            Back to Maths Hub
          </a>
        </div>
      </header>

      <!-- Hero -->
      <section class="bg-white p-6 rounded-xl shadow-sm mb-6">
        <div class="flex items-start justify-between flex-wrap gap-4">
          <div>
            <p class="uppercase tracking-wide text-xs text-gray-500 mb-1">
              Simultaneous Equations
            </p>
            <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800">
              Elimination Agent
            </h1>
            <p class="text-gray-600 mt-2 max-w-2xl">
              Your mission: Eliminate the variables. Complete Mission 1 to unlock the Advanced Solver protocols.
            </p>
          </div>

          <div class="flex flex-col items-end gap-2 text-sm text-gray-500">
            <div class="flex items-center gap-1">
              <span class="material-icons text-base text-gray-400">group</span>
              <span>Made by: <span class="font-semibold text-gray-800">SJWMS Maths Dept</span></span>
            </div>
            <div class="flex items-center gap-1">
              <span class="material-icons text-base text-gray-400">calculate</span>
              <span>Focus: <span class="font-semibold text-gray-800">Algebra / Elimination</span></span>
            </div>
          </div>
        </div>
      </section>

      <!-- GAME AREA -->
      <section class="mt-6 grid grid-cols-1 lg:grid-cols-[minmax(0,3fr),minmax(0,2fr)] gap-6">
        <!-- Left: Game -->
        <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-200 overflow-hidden relative">
          <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <span class="material-icons text-[20px] text-violet-500">local_police</span>
            Mission Console
          </h2>

          <div id="game-root"
               class="bg-stripes rounded-xl min-h-[380px] md:min-h-[450px] flex items-center justify-center text-center px-4 py-6 relative z-10">
            <div class="max-w-md text-gray-700">
              <div class="animate-pulse flex flex-col items-center">
                <span class="material-icons text-4xl text-violet-300 mb-2">fingerprint</span>
                <p>Initializing Mission...</p>
              </div>
            </div>
          </div>
          
          <div id="effects-layer" class="absolute inset-0 pointer-events-none z-0 overflow-hidden"></div>
        </div>

        <!-- Right: Instructions -->
        <div class="space-y-4">
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-lg font-semibold text-gray-800 mb-2 flex items-center gap-2">
              <span class="material-icons text-[20px] text-gray-500">menu_book</span>
              Field Manual
            </h2>
            <p class="text-sm text-gray-700 space-y-2">
              <span class="block"><strong>1. Same Signs Subtract (SSS):</strong> If variables match exactly (e.g. +3y and +3y), Subtract.</span>
              <span class="block"><strong>2. Double Agents:</strong> If neither variable matches (e.g. 2x and 3x), you must multiply <strong>BOTH</strong> equations to find a common multiple (like 6x).</span>
              <span class="block"><strong>3. The Extraction:</strong> Once eliminated, solve for the first letter, then substitute back in to find the second.</span>
            </p>
          </div>

          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-lg font-semibold text-gray-800 mb-2 flex items-center gap-2">
              <span class="material-icons text-[20px] text-gray-500">psychology</span>
              Maths focus
            </h2>
            <p class="text-sm text-gray-700 mb-2">
              Balancing coefficients and substituting values to solve linear systems.
            </p>
          </div>
        </div>
      </section>

      <!-- Spacer -->
      <div class="h-10"></div>
    </main>
  </div>

  <script src="/assets/sidebar-loader.js"></script>

  <!-- === GAME SCRIPT === -->
  <script>
    (function () {
      const root = document.getElementById("game-root");
      const effectsLayer = document.getElementById("effects-layer");
      if (!root) return;

      // --- UTILS ---
      const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
      const coinFlip = () => Math.random() < 0.5;

      const createEq = (a, b, c) => {
          const signB = b >= 0 ? '+' : '-';
          const absB = Math.abs(b);
          const fmt = (n, v) => {
              if (n === 1) return v;
              if (n === -1) return `-${v}`;
              if (n === 0) return ""; 
              return `${n}${v}`;
          };
          return {
              html: `<span class="font-bold">${fmt(a, 'x')}</span> <span class="mx-1 text-gray-400">${signB}</span> <span class="font-bold">${fmt(absB, 'y')}</span> = ${c}`,
              vals: {a, b, c}
          };
      };

      // --- GAME STATE ---
      let currentLevel = 0;
      let score = 0;
      let questions = [];

      function generateQuestions() {
          const q = [];
          
          // --- MISSION 1 ---
          q.push({
              type: 'intro',
              title: "Mission 1: The Basics",
              text: "Agent, we need you to identify engagement protocols. Decide whether to <strong>ADD</strong> or <strong>SUBTRACT</strong> to eliminate targets.",
              btnText: "Start Mission 1"
          });

          // Levels 1-3: Decision
          for(let i=0; i<3; i++) {
              const x = randInt(2, 5);
              const y = randInt(2, 5);
              const matchX = coinFlip(); 
              let a1, b1, a2, b2;

              if(matchX) {
                  a1 = randInt(2, 5); a2 = a1; if(coinFlip()) a2 = -a2; 
                  b1 = randInt(2, 5); b2 = randInt(2, 5); if(b1 === b2) b2++; 
              } else {
                  b1 = randInt(2, 5); b2 = b1; if(coinFlip()) b2 = -b2;
                  a1 = randInt(2, 5); a2 = randInt(2, 5); if(a1 === a2) a2++;
              }
              const c1 = a1*x + b1*y;
              const c2 = a2*x + b2*y;
              
              let coeff1 = matchX ? a1 : b1;
              let coeff2 = matchX ? a2 : b2;
              let action = Math.sign(coeff1) === Math.sign(coeff2) ? "subtract" : "add";

              q.push({
                  type: 'decision',
                  eq1: createEq(a1, b1, c1),
                  eq2: createEq(a2, b2, c2),
                  target: matchX ? "x" : "y",
                  correct: action
              });
          }

          // Level 4: Single Multiplier
          {
              const x = randInt(2, 4);
              const y = randInt(2, 4);
              let a1 = randInt(2, 3);
              let b1 = randInt(2, 3);
              const k = randInt(2, 3);
              let a2 = a1 * k;
              let b2 = randInt(2, 9);
              
              const c1 = a1*x + b1*y;
              const c2 = a2*x + b2*y;

              q.push({
                  type: 'multiplier',
                  eq1: createEq(a1, b1, c1),
                  eq2: createEq(a2, b2, c2),
                  target: "x",
                  correct: k
              });
          }

          // --- MISSION 2 ---
          q.push({
              type: 'intro',
              title: "Mission 2: Deep Cover",
              text: "Excellent work. You are now cleared for <strong>Advanced Operations</strong>.<br>You will encounter double-encrypted variables and be required to solve for full extraction.",
              btnText: "Start Mission 2"
          });

          // Level 5-6: Double Multiplier (LCM)
          for(let i=0; i<2; i++) {
               const x = randInt(2, 5);
               const y = randInt(2, 5);
               // Primes or coprime small numbers
               const pairs = [[2,3], [3,2], [3,4], [3,5]];
               const p = pairs[randInt(0, pairs.length-1)];
               
               let a1, a2, b1, b2;
               const matchX = coinFlip();
               
               if(matchX) {
                   // Target X (e.g. 2x and 3x)
                   a1 = p[0];
                   a2 = p[1];
                   b1 = randInt(2,5);
                   b2 = randInt(2,5);
                   // Correct mults: eq1 * a2, eq2 * a1
               } else {
                   // Target Y
                   b1 = p[0];
                   b2 = p[1];
                   a1 = randInt(2,5);
                   a2 = randInt(2,5);
               }

               const c1 = a1*x + b1*y;
               const c2 = a2*x + b2*y;

               q.push({
                   type: 'double_mult',
                   eq1: createEq(a1, b1, c1),
                   eq2: createEq(a2, b2, c2),
                   target: matchX ? "x" : "y",
                   correctM1: matchX ? a2 : b2,
                   correctM2: matchX ? a1 : b1
               });
          }

          // Level 7-8: The Solve (Extraction)
          for(let i=0; i<2; i++) {
              const x = randInt(2, 6);
              const y = randInt(2, 6);
              
              // We simulate the end of an elimination
              // e.g. "We eliminated x. Result: 4y = 24"
              // Pick coeff for y
              const cy = randInt(2, 8);
              const resultVal = cy * y;
              
              // For the substitution part, we need an original equation
              // e.g. 2x + 3y = ?
              const a = randInt(2, 5);
              const b = randInt(2, 5); // This represents the y coeff in the original eq
              const c = a*x + b*y;
              
              q.push({
                  type: 'solve',
                  elimResultStr: `${cy}y = ${resultVal}`,
                  subEqStr: `${a}x + ${b}y = ${c}`,
                  var1: 'y',
                  var2: 'x',
                  val1: y,
                  val2: x,
                  subCoeff: b // to show "2x + 3(4) = ..."
              });
          }

          q.push({ type: 'end', title: "Mission Accomplished" });
          return q;
      }

      // --- RENDERING ---

      function render() {
          root.innerHTML = "";
          const data = questions[currentLevel];

          const container = document.createElement("div");
          container.className = "w-full max-w-lg bg-white/95 backdrop-blur rounded-xl shadow-lg border border-gray-100 p-4 md:p-8 flex flex-col gap-4 transition-all duration-300 relative z-20";

          // INTRO
          if (data.type === 'intro') {
            const isMission2 = data.title.includes("Mission 2");
            const icon = isMission2 ? "security" : "visibility";
            const color = isMission2 ? "text-rose-600" : "text-violet-600";
            const bg = isMission2 ? "bg-rose-100" : "bg-violet-100";
            
            container.innerHTML = `
                <div class="text-center py-6">
                    <div class="w-16 h-16 ${bg} rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="material-icons text-3xl ${color}">${icon}</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">${data.title}</h2>
                    <p class="text-gray-600 mb-6 leading-relaxed">${data.text}</p>
                    <button id="next-btn" class="bg-gray-900 hover:bg-black text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 flex items-center gap-2 mx-auto">
                        <span class="material-icons">double_arrow</span> ${data.btnText}
                    </button>
                </div>
            `;
            root.appendChild(container);
            container.querySelector("#next-btn").onclick = nextLevel;
            return;
          }

          // END
          if (data.type === 'end') {
            spawnConfetti();
            container.innerHTML = `
                <div class="text-center py-6">
                    <span class="material-icons text-6xl text-yellow-500 mb-4">military_tech</span>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">${data.title}</h2>
                    <div class="text-4xl font-extrabold text-violet-600 my-4">${score} / ${questions.length - 3}</div>
                    <p class="text-gray-600 mb-6 font-medium">Agent status: Certified Expert.</p>
                    <button id="reset-btn" class="text-violet-600 hover:text-violet-800 font-semibold flex items-center justify-center gap-2 mx-auto border border-violet-200 px-4 py-2 rounded-lg hover:bg-violet-50 transition-colors">
                        <span class="material-icons">replay</span> New Mission
                    </button>
                </div>
            `;
            root.appendChild(container);
            container.querySelector("#reset-btn").onclick = () => {
                effectsLayer.innerHTML = ''; 
                questions = generateQuestions(); 
                currentLevel = 0;
                score = 0;
                render();
            };
            return;
          }

          // GAME HEADER
          const header = document.createElement("div");
          header.className = "flex justify-between items-center text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 border-b border-gray-100 pb-2";
          header.innerHTML = `<span>Task ${currentLevel}</span> <span>Score: ${score}</span>`;
          container.appendChild(header);

          // INSTRUCTION TITLE
          const title = document.createElement("h3");
          title.className = "text-lg font-medium text-gray-800 text-center mb-4";
          
          if(data.type === 'decision') title.innerHTML = `Action required to eliminate <strong class="text-violet-600 text-xl font-mono mx-1">${data.target}</strong>?`;
          if(data.type === 'multiplier') title.innerHTML = `Multiply <strong>Equation 1</strong> to match <strong class="text-violet-600 font-mono">${data.target}</strong> in Eq 2.`;
          if(data.type === 'double_mult') title.innerHTML = `Multiply <span class="text-rose-500 font-bold">BOTH</span> equations to match <strong class="text-violet-600 font-mono">${data.target}</strong>.`;
          if(data.type === 'solve') title.innerHTML = `<span class="text-blue-600 font-bold">EXTRACTION PHASE:</span> Solve for variables.`;
          
          container.appendChild(title);

          // CONTENT AREA
          // 1. Equations (shown for all except 'solve' initially)
          if(data.type !== 'solve') {
              const eqsBox = document.createElement("div");
              eqsBox.className = "bg-slate-50 border border-slate-200 rounded-lg p-4 mb-4 flex flex-col gap-3 shadow-inner relative overflow-hidden";
              eqsBox.innerHTML = `
                  <div class="flex items-center gap-3 eq-card text-xl md:text-2xl text-slate-700 justify-center relative z-10">
                    <span class="text-xs text-slate-400 w-4 text-right font-sans absolute left-0">1</span> ${data.eq1.html}
                  </div>
                  <div class="flex items-center gap-3 eq-card text-xl md:text-2xl text-slate-700 justify-center relative z-10">
                    <span class="text-xs text-slate-400 w-4 text-right font-sans absolute left-0">2</span> ${data.eq2.html}
                  </div>
              `;
              container.appendChild(eqsBox);
          }

          const controls = document.createElement("div");
          controls.className = "flex flex-col gap-3";
          container.appendChild(controls);

          const feedback = document.createElement("div");
          feedback.className = "text-center min-h-[40px] flex items-center justify-center text-sm font-medium mt-2";
          feedback.id = "feedback";
          container.appendChild(feedback);

          // -- UI GENERATION BY TYPE --

          // DECISION
          if (data.type === 'decision') {
             const btnRow = document.createElement("div");
             btnRow.className = "grid grid-cols-2 gap-4";
             ['add', 'subtract'].forEach(op => {
                 const btn = document.createElement("button");
                 btn.className = "flex flex-col items-center justify-center p-4 rounded-xl border-2 border-slate-200 hover:border-violet-500 hover:bg-violet-50 transition-all active:scale-95 group";
                 const icon = op === 'add' ? 'add_circle' : 'remove_circle';
                 const color = op === 'add' ? 'text-emerald-500' : 'text-rose-500';
                 const label = op === 'add' ? 'ADD (+)' : 'SUBTRACT (-)';
                 btn.innerHTML = `<span class="material-icons text-4xl mb-1 ${color} group-hover:scale-110 transition-transform">${icon}</span><span class="font-bold text-slate-600 uppercase text-sm">${label}</span>`;
                 btn.onclick = () => checkAnswer(op === data.correct, btn, `Hint: Same Signs Subtract, Different Signs Add.`);
                 btnRow.appendChild(btn);
             });
             controls.appendChild(btnRow);
          }

          // MULTIPLIER
          if (data.type === 'multiplier') {
              const btnRow = document.createElement("div");
              btnRow.className = "grid grid-cols-3 gap-3";
              [2, 3, 4].forEach(num => {
                  const btn = document.createElement("button");
                  btn.className = "p-4 rounded-lg bg-white border-2 border-slate-200 text-xl font-bold text-slate-700 hover:border-violet-500 hover:text-violet-600 shadow-sm active:bg-violet-50 transition-all";
                  btn.textContent = `× ${num}`;
                  btn.onclick = () => checkAnswer(num === data.correct, btn, `Look for the factor that scales Eq 1 to Eq 2.`);
                  btnRow.appendChild(btn);
              });
              controls.appendChild(btnRow);
          }

          // DOUBLE MULTIPLIER
          if (data.type === 'double_mult') {
              const row = document.createElement("div");
              row.className = "flex flex-col gap-4 items-center";
              row.innerHTML = `
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-bold text-slate-500">Eq 1 × </span>
                    <input id="m1" type="number" class="w-16 h-12 text-center text-xl font-bold border-2 border-slate-200 rounded-lg focus:border-violet-500 focus:ring-0">
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-bold text-slate-500">Eq 2 × </span>
                    <input id="m2" type="number" class="w-16 h-12 text-center text-xl font-bold border-2 border-slate-200 rounded-lg focus:border-violet-500 focus:ring-0">
                  </div>
                  <button id="check-double" class="w-full bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 rounded-lg shadow mt-2">Check Scaling</button>
              `;
              controls.appendChild(row);

              row.querySelector("#check-double").onclick = () => {
                  const m1 = parseInt(document.getElementById("m1").value);
                  const m2 = parseInt(document.getElementById("m2").value);
                  if(isNaN(m1) || isNaN(m2)) return;
                  
                  // Check if the ratio is correct (allowing for common multiples like 2,3 vs 4,6)
                  // But simplest check is: do they create the same coeff?
                  // We need to know the original coeffs.
                  // Or just check against data.correctM1/M2 assuming simplest form?
                  // Let's accept any pair that equalizes the magnitude.
                  // Original coeffs: data.eq1.vals.a (if x) or b (if y).
                  
                  // Easier logic: Check if user input matches expected LCM logic
                  // Actually, let's just use strict check for simplicity in this demo
                  const isCorrect = (m1 === data.correctM1 && m2 === data.correctM2) || (m1 === -data.correctM1 && m2 === -data.correctM2);
                  
                  const btn = row.querySelector("#check-double");
                  if(isCorrect) {
                      checkAnswer(true, btn, "");
                  } else {
                      checkAnswer(false, btn, `Try swapping coefficients! To match ${data.eq1.vals.a}x and ${data.eq2.vals.a}x, multiply by each other.`);
                  }
              };
          }

          // SOLVE PHASE
          if (data.type === 'solve') {
              const solveBox = document.createElement("div");
              solveBox.className = "flex flex-col gap-4";
              
              // Step 1: Find Var 1
              solveBox.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 text-center animate-pulse-once">
                    <p class="text-xs text-blue-500 uppercase font-bold mb-1">Status: Elimination Successful</p>
                    <p class="text-2xl font-mono text-blue-900 tracking-wider">${data.elimResultStr}</p>
                </div>
                <div class="flex items-center justify-center gap-2">
                    <span class="font-bold text-xl text-gray-700 font-mono">${data.var1} = </span>
                    <input type="number" id="inp1" class="w-20 text-center font-bold text-xl border-b-2 border-l-0 border-r-0 border-t-0 border-gray-300 bg-transparent focus:ring-0 focus:border-violet-500">
                </div>
                <div id="step2-container" class="opacity-30 pointer-events-none transition-all duration-500 mt-4 border-t border-gray-200 pt-4">
                     <p class="text-sm text-gray-500 mb-2">Substitute ${data.var1} into: <span class="font-mono text-gray-800">${data.subEqStr}</span></p>
                     <div class="flex items-center justify-center gap-2">
                        <span class="font-bold text-xl text-gray-700 font-mono">${data.var2} = </span>
                        <input type="number" id="inp2" class="w-20 text-center font-bold text-xl border-b-2 border-l-0 border-r-0 border-t-0 border-gray-300 bg-transparent focus:ring-0 focus:border-violet-500">
                     </div>
                     <button id="final-submit" class="w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 rounded shadow">Complete Extraction</button>
                </div>
              `;
              controls.appendChild(solveBox);

              const inp1 = solveBox.querySelector("#inp1");
              const step2 = solveBox.querySelector("#step2-container");
              const inp2 = solveBox.querySelector("#inp2");
              const btn = solveBox.querySelector("#final-submit");

              // Reveal Step 2 when Step 1 is correct
              inp1.addEventListener("input", (e) => {
                  const val = parseInt(e.target.value);
                  if (val === data.val1) {
                      inp1.classList.add("text-emerald-600", "border-emerald-500");
                      inp1.disabled = true;
                      step2.classList.remove("opacity-30", "pointer-events-none");
                      inp2.focus();
                  }
              });

              btn.onclick = () => {
                  const val2 = parseInt(inp2.value);
                  if (val2 === data.val2) {
                      checkAnswer(true, btn, "");
                  } else {
                      btn.classList.add("shake", "bg-rose-600");
                      setTimeout(() => btn.classList.remove("shake", "bg-rose-600"), 500);
                      feedback.innerHTML = `<span class="text-rose-600">Incorrect. Substitute ${data.var1}=${data.val1} into the equation.</span>`;
                  }
              };
          }

          root.appendChild(container);

          // -- CHECK LOGIC --
          function checkAnswer(isCorrect, btnElement, hintText) {
              const fb = document.getElementById("feedback");
              
              if(isCorrect) {
                  if(btnElement) {
                      btnElement.classList.remove("bg-rose-600", "bg-violet-600", "bg-emerald-600");
                      btnElement.classList.add("bg-emerald-100", "border-emerald-500", "text-emerald-700");
                      btnElement.disabled = true;
                  }
                  fb.innerHTML = `<span class="text-emerald-600 flex items-center gap-1 justify-center"><span class="material-icons text-base">check_circle</span> Correct!</span>`;
                  score++;
                  setTimeout(nextLevel, 1200);
              } else {
                  if(btnElement) {
                      btnElement.classList.add("shake", "bg-rose-100", "border-rose-500", "text-rose-700");
                      setTimeout(() => btnElement.classList.remove("shake"), 400);
                  }
                  fb.innerHTML = `<span class="text-rose-600 font-semibold">${hintText}</span>`;
                  
                  if(!document.getElementById("skip-btn")) {
                    const contBtn = document.createElement("button");
                    contBtn.id = "skip-btn";
                    contBtn.textContent = "Skip ->";
                    contBtn.className = "mt-2 text-xs font-bold text-slate-400 hover:text-slate-600";
                    contBtn.onclick = nextLevel;
                    fb.appendChild(document.createElement("br"));
                    fb.appendChild(contBtn);
                  }
              }
          }
      }

      function nextLevel() {
          currentLevel++;
          if (currentLevel < questions.length) {
              render();
          }
      }

      function spawnConfetti() {
        for (let i = 0; i < 50; i++) {
          const c = document.createElement("div");
          c.className = "confetti";
          c.style.left = Math.random() * 100 + "%";
          c.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`;
          c.style.animationDuration = Math.random() * 2 + 1 + "s";
          c.style.top = -10 + "px";
          effectsLayer.appendChild(c);
        }
      }

      // Start
      questions = generateQuestions();
      render();

    })();
  </script>
</body>
</html>
